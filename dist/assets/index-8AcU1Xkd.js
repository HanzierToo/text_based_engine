var Ys=Object.defineProperty;var Gs=(n,e,t)=>e in n?Ys(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var W=(n,e,t)=>Gs(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function Q(){}function Zn(n){return n()}function En(){return Object.create(null)}function Ge(n){n.forEach(Zn)}function xn(n){return typeof n=="function"}function lt(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function zs(n){return Object.keys(n).length===0}function es(n,...e){if(n==null){for(const s of e)s(void 0);return Q}const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ts(n){let e;return es(n,t=>e=t)(),e}function ns(n,e,t){n.$$.on_destroy.push(es(e,t))}function w(n,e){n.appendChild(e)}function J(n,e,t){n.insertBefore(e,t||null)}function z(n){n.parentNode&&n.parentNode.removeChild(n)}function $t(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function A(n){return document.createElement(n)}function P(n){return document.createTextNode(n)}function j(){return P(" ")}function ss(){return P("")}function rn(n,e,t,s){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t,s)}function M(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Js(n){return Array.from(n.childNodes)}function ne(n,e){e=""+e,n.data!==e&&(n.data=e)}let it;function tt(n){it=n}function Hs(){if(!it)throw new Error("Function called outside component initialization");return it}function Ws(n){Hs().$$.on_mount.push(n)}const Be=[],In=[];let qe=[];const On=[],Qs=Promise.resolve();let Wt=!1;function Xs(){Wt||(Wt=!0,Qs.then(is))}function Qt(n){qe.push(n)}const Rt=new Set;let Le=0;function is(){if(Le!==0)return;const n=it;do{try{for(;Le<Be.length;){const e=Be[Le];Le++,tt(e),Zs(e.$$)}}catch(e){throw Be.length=0,Le=0,e}for(tt(null),Be.length=0,Le=0;In.length;)In.pop()();for(let e=0;e<qe.length;e+=1){const t=qe[e];Rt.has(t)||(Rt.add(t),t())}qe.length=0}while(Be.length);for(;On.length;)On.pop()();Wt=!1,Rt.clear(),tt(n)}function Zs(n){if(n.fragment!==null){n.update(),Ge(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Qt)}}function xs(n){const e=[],t=[];qe.forEach(s=>n.indexOf(s)===-1?e.push(s):t.push(s)),t.forEach(s=>s()),qe=e}const wt=new Set;let ve;function rs(){ve={r:0,c:[],p:ve}}function os(){ve.r||Ge(ve.c),ve=ve.p}function ye(n,e){n&&n.i&&(wt.delete(n),n.i(e))}function Ee(n,e,t,s){if(n&&n.o){if(wt.has(n))return;wt.add(n),ve.c.push(()=>{wt.delete(n),s&&(t&&n.d(1),s())}),n.o(e)}else s&&s()}function ce(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function ei(n,e){Ee(n,1,1,()=>{e.delete(n.key)})}function ti(n,e,t,s,i,r,o,l,c,a,u,f){let d=n.length,p=r.length,g=d;const h={};for(;g--;)h[n[g].key]=g;const m=[],y=new Map,k=new Map,N=[];for(g=p;g--;){const b=f(i,r,g),_=t(b);let O=o.get(_);O?N.push(()=>O.p(b,e)):(O=a(_,b),O.c()),y.set(_,m[g]=O),_ in h&&k.set(_,Math.abs(g-h[_]))}const S=new Set,E=new Set;function T(b){ye(b,1),b.m(l,u),o.set(b.key,b),u=b.first,p--}for(;d&&p;){const b=m[p-1],_=n[d-1],O=b.key,C=_.key;b===_?(u=b.first,d--,p--):y.has(C)?!o.has(O)||S.has(O)?T(b):E.has(C)?d--:k.get(O)>k.get(C)?(E.add(O),T(b)):(S.add(C),d--):(c(_,o),d--)}for(;d--;){const b=n[d];y.has(b.key)||c(b,o)}for(;p;)T(m[p-1]);return Ge(N),m}function Xt(n){n&&n.c()}function St(n,e,t){const{fragment:s,after_update:i}=n.$$;s&&s.m(e,t),Qt(()=>{const r=n.$$.on_mount.map(Zn).filter(xn);n.$$.on_destroy?n.$$.on_destroy.push(...r):Ge(r),n.$$.on_mount=[]}),i.forEach(Qt)}function Nt(n,e){const t=n.$$;t.fragment!==null&&(xs(t.after_update),Ge(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ni(n,e){n.$$.dirty[0]===-1&&(Be.push(n),Xs(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Tt(n,e,t,s,i,r,o=null,l=[-1]){const c=it;tt(n);const a=n.$$={fragment:null,ctx:[],props:r,update:Q,not_equal:i,bound:En(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:En(),dirty:l,skip_bound:!1,root:e.target||c.$$.root};o&&o(a.root);let u=!1;if(a.ctx=t?t(n,e.props||{},(f,d,...p)=>{const g=p.length?p[0]:d;return a.ctx&&i(a.ctx[f],a.ctx[f]=g)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](g),u&&ni(n,f)),d}):[],a.update(),u=!0,Ge(a.before_update),a.fragment=s?s(a.ctx):!1,e.target){if(e.hydrate){const f=Js(e.target);a.fragment&&a.fragment.l(f),f.forEach(z)}else a.fragment&&a.fragment.c();e.intro&&ye(n.$$.fragment),St(n,e.target,e.anchor),is()}tt(c)}class At{constructor(){W(this,"$$");W(this,"$$set")}$destroy(){Nt(this,1),this.$destroy=Q}$on(e,t){if(!xn(t))return Q;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!zs(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const si="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(si);const ii=`game:
  id: boiler_7
  title: Boiler 7
  version: "0.1"

  start:
    scene: arrival
    node: dock
  
  ui:
    theme: default
    text_speed: normal`,ri=`items:
  inspector_badge:
    name: boiler.item.badge.name
    description: boiler.item.badge.description

  valve_key:
    name: boiler.item.valve_key.name
    description: boiler.item.valve_key.description

  maintenance_log:
    name: boiler.item.log.name
    description: boiler.item.log.description

  sealed_report:
    name: boiler.item.report.name
    description: boiler.item.report.description
`,oi=`boiler:
  choice:
    enter_floor: "Enter the boiler floor"
    inspect_valve: "Inspect the auxiliary manifold"
    speak_worker: "Speak to the machinist"
    go_control: "Proceed to the control room"
    read_logs: "Review maintenance logs"
    descend: "Descend to the lower chamber"
    return: "Return to the boiler floor"
    back: "Go back"
    stabilize: "Attempt manual stabilization"
    investigate: "Inspect regulator housing"
    retreat: "Retreat to control room"
    proceed_end: "Complete inspection and file report"
    stabilize_after: "Stabilize the regulator"
    take_valve_key: "Take the valve key"
    listen_worker: "Press the machinist for details"
    submit_report: "Submit official report"

  item:
    badge:
      name: "Inspection Badge"
      description: "Test1"
    valve_key:
      name: "Valve Key"
      description: "Test2"
    log:
      name: "Maintenance Logbook"
      description: "Test3"
    report:
      name: "Sealed Report"
      description: "Test4"

  arrival:
    dock: >
      The river fog hangs low over Dock 17.
      Boiler 7's exhaust tower cuts through the mist like a blade.
      The district depends on this unit. If it fails, half the lower wards go dark.
      Your inspection orders are stamped urgent.

  floor:
    main: >
      The boiler floor trembles beneath rotating pistons and hissing valves.
      Workers move with deliberate efficiency, but conversations stop when you pass.
      Pressure gauges along the far wall flicker slightly above normal range.

    valve: >
      The auxiliary pressure manifold is partially disassembled.
      A heavy brass valve key rests on a maintenance hook.
      No one seems eager to claim responsibility.

    worker: >
      A soot-streaked machinist glances at your badge, then away.
      After a pause, they lean closer.
      "The readings started spiking three nights ago.
      Management says it's drift.
      It isn't drift."

    main_worker_warning: >
      The machinist's warning lingers in your thoughts.

  control:
    entry: >
      The control room overlooks the boiler core through reinforced glass.
      Brass levers line the console.
      The central pressure needle vibrates against its housing.

    logs: >
      The maintenance ledger shows repeated recalibrations filed and overwritten.
      Several entries are signed, then crossed out.
      Someone adjusted tolerance limits upward.

    entry_tampering_found: >
      The falsified calibration logs shift your perception of the room.

  lower:
    entrance: >
      The lower chamber radiates dry heat.
      Steam condenses along the iron ribs of the chamber walls.
      The primary regulator housing groans under strain.

    no_valve_key_hint: >
      Without the proper valve key, any manual adjustment would be reckless.

    no_tampering_hint: >
      Nothing here immediately suggests deliberate interference.
      It could still be mechanical fatigue.

    stabilize: >
      You slot the valve key into the regulator assembly.
      A controlled counterturn releases trapped pressure in measured bursts.
      The chamber's vibration eases, though the system remains fragile.

    tampering: >
      Behind the regulator casing, a calibration stop has been filed down.
      Not worn.
      Filed.
      The boiler was forced to tolerate higher pressure than design allowed.

    valve_ready: >
      With the valve key in hand, manual adjustment is possible.

    entrance_suspicion: >
      Knowing the regulator was altered changes the meaning of every vibration.

  conclusion:
    final: >
      Boiler 7 stabilizes under your intervention.
      The district lights will hold tonight.
      What follows depends on what you choose to report.

    neutral: >
      You file a technical summary.
      No accusations.
      No names.
      The Guild will review internally.

    worker_trust: >
      You attach documentation of the tampering.
      The machinists will know someone listened.
      The Guild will not appreciate the implication.

    isolated: >
      You restrict your report to mechanical anomalies.
      Quietly.
      Whatever this was, it will remain buried.

    end: >
      The report is sealed and filed.
      Boiler 7 will hold â€” for now.
      Whatever forces strained the regulator remain outside the scope of your duty.
      The district sleeps with its lights intact.
`,li=`rules:
  systems:
    randomness: false
    inventory: true
    statistics: false
    combat: false

  state_visibility:
    default: visible`,ai=`scene:
  id: arrival
  nodes:

    - id: dock
      text:
        - key: boiler.arrival.dock
      choices:
        - id: enter_floor
          text: boiler.choice.enter_floor
          effects:
            - add_item:
                id: inspector_badge
          goto:
            scene: boiler_floor
            node: main`,ci=`scene:
  id: boiler_floor
  nodes:

    - id: main
      text:
        - key: boiler.floor.main

        - if:
            eq:
              var: worker_warning
              value: true
          then:
            key: boiler.floor.main_worker_warning

      choices:
        - id: inspect_valve
          text: boiler.choice.inspect_valve
          goto:
            scene: boiler_floor
            node: valve

        - id: speak_worker
          text: boiler.choice.speak_worker
          goto:
            scene: boiler_floor
            node: worker

        - id: go_control
          text: boiler.choice.go_control
          goto:
            scene: control_room
            node: entry

    - id: valve
      text:
        - key: boiler.floor.valve
      choices:
        - id: take_valve_key
          text: boiler.choice.take_valve_key
          if:
            eq:
              var: has_valve_key
              value: false
          effects:
            - add_item:
                id: valve_key
            - set:
                var: has_valve_key
                value: true
          goto:
            scene: boiler_floor
            node: main

        - id: back_main
          text: boiler.choice.back
          goto:
            scene: boiler_floor
            node: main

    - id: worker
      text:
        - key: boiler.floor.worker
      choices:
        - id: listen_worker
          text: boiler.choice.listen_worker
          if:
            eq:
              var: worker_warning
              value: false
          effects:
            - set:
                var: worker_warning
                value: true
            - add:
                var: trust_level
                value: 1
          goto:
            scene: boiler_floor
            node: main

        - id: back_main
          text: boiler.choice.back
          goto:
            scene: boiler_floor
            node: main`,fi=`scene:
  id: conclusion
  nodes:

    - id: final
      text:
        - key: boiler.conclusion.final

        - if:
            eq:
              var: trust_level
              value: 0
          then:
            key: boiler.conclusion.neutral

        - if:
            gt:
              var: trust_level
              value: 0
          then:
            key: boiler.conclusion.worker_trust

        - if:
            lt:
              var: trust_level
              value: 0
          then:
            key: boiler.conclusion.isolated

      choices:
        - id: submit_report
          text: boiler.choice.submit_report
          if:
            eq:
              var: report_submitted
              value: false
          effects:
            - add_item:
                id: sealed_report
            - set:
                var: report_submitted
                value: true
          goto:
            scene: conclusion
            node: end

    - id: end
      text:
        - key: boiler.conclusion.end
      choices: []`,ui=`scene:
  id: control_room
  nodes:

    - id: entry
      text:
        - key: boiler.control.entry

        - if:
            eq:
              var: discovered_tampering
              value: true
          then:
            key: boiler.control.entry_tampering_found

      choices:
        - id: read_logs
          text: boiler.choice.read_logs
          if:
            eq:
              var: discovered_tampering
              value: false
          effects:
            - add_item:
                id: maintenance_log
            - set:
                var: discovered_tampering
                value: true
          goto:
            scene: control_room
            node: entry

        - id: descend
          text: boiler.choice.descend
          goto:
            scene: lower_chamber
            node: entrance

        - id: return_floor
          text: boiler.choice.return
          goto:
            scene: boiler_floor
            node: main`,hi=`scene:
  id: lower_chamber
  nodes:

    - id: entrance
      text:
        - key: boiler.lower.entrance

        - if:
            eq:
              var: has_valve_key
              value: false
          then:
            key: boiler.lower.no_valve_key_hint

        - if:
            eq:
              var: has_valve_key
              value: true
          then:
            key: boiler.lower.valve_ready

        - if:
            eq:
              var: discovered_tampering
              value: false
          then:
            key: boiler.lower.no_tampering_hint

        - if:
            eq:
              var: discovered_tampering
              value: true
          then:
            key: boiler.lower.entrance_suspicion

      choices:
        - id: investigate
          text: boiler.choice.investigate
          if:
            all:
              - eq:
                  var: discovered_tampering
                  value: true
              - eq:
                  var: investigated_regulator
                  value: false
          effects:
            - set:
                var: investigated_regulator
                value: true
            - add:
                var: trust_level
                value: -1
          goto:
            scene: lower_chamber
            node: tampering_result

        - id: stabilize
          text: boiler.choice.stabilize
          if:
            eq:
              var: has_valve_key
              value: true
          effects:
            - add:
                var: pressure_level
                value: -1
          goto:
            scene: conclusion
            node: final

        - id: retreat
          text: boiler.choice.retreat
          goto:
            scene: control_room
            node: entry

    - id: tampering_result
      text:
        - key: boiler.lower.tampering
      choices:
        - id: back_entrance
          text: boiler.choice.back
          goto:
            scene: lower_chamber
            node: entrance`,di=`state:
  variables:

    has_valve_key:
      type: boolean
      initial: false
      visible: true

    worker_warning:
      type: boolean
      initial: false
      visible: true

    discovered_tampering:
      type: boolean
      initial: false
      visible: true

    investigated_regulator:
      type: boolean
      initial: false
      visible: true

    report_submitted:
      type: boolean
      initial: false
      visible: true

    trust_level:
      type: number
      initial: 0
      visible: true

    pressure_level:
      type: number
      initial: 3
      visible: true`;function pi(){const n=Object.assign({"/src/game/game.yaml":ii,"/src/game/items.yaml":ri,"/src/game/localization/en.yaml":oi,"/src/game/rules.yaml":li,"/src/game/scenes/arrival.yaml":ai,"/src/game/scenes/boiler_floor.yaml":ci,"/src/game/scenes/conclusion.yaml":fi,"/src/game/scenes/control_room.yaml":ui,"/src/game/scenes/lower_chamber.yaml":hi,"/src/game/state.yaml":di});let e=null,t=null,s=null,i=null;const r={},o={};for(const[l,c]of Object.entries(n))if(l.endsWith("/game.yaml"))e=c;else if(l.endsWith("/rules.yaml"))t=c;else if(l.endsWith("/state.yaml"))s=c;else if(l.endsWith("/items.yaml"))i=c;else if(l.includes("/scenes/")){const a=l.split("/scenes/")[1];r[a]=c}else if(l.includes("/localization/")){const a=l.split("/localization/")[1];o[a]=c}if(!e)throw new Error("Missing required file: game.yaml");if(!t)throw new Error("Missing required file: rules.yaml");if(!s)throw new Error("Missing required file: state.yaml");if(!i)throw new Error("Missing required file: items.yaml");return{game:e,rules:t,state:s,items:i,scenes:r,localization:o}}const on=Symbol.for("yaml.alias"),Zt=Symbol.for("yaml.document"),be=Symbol.for("yaml.map"),ls=Symbol.for("yaml.pair"),fe=Symbol.for("yaml.scalar"),ze=Symbol.for("yaml.seq"),oe=Symbol.for("yaml.node.type"),$e=n=>!!n&&typeof n=="object"&&n[oe]===on,Lt=n=>!!n&&typeof n=="object"&&n[oe]===Zt,at=n=>!!n&&typeof n=="object"&&n[oe]===be,V=n=>!!n&&typeof n=="object"&&n[oe]===ls,D=n=>!!n&&typeof n=="object"&&n[oe]===fe,ct=n=>!!n&&typeof n=="object"&&n[oe]===ze;function R(n){if(n&&typeof n=="object")switch(n[oe]){case be:case ze:return!0}return!1}function U(n){if(n&&typeof n=="object")switch(n[oe]){case on:case be:case fe:case ze:return!0}return!1}const as=n=>(D(n)||R(n))&&!!n.anchor,_e=Symbol("break visit"),mi=Symbol("skip children"),nt=Symbol("remove node");function Je(n,e){const t=gi(e);Lt(n)?je(null,n.contents,t,Object.freeze([n]))===nt&&(n.contents=null):je(null,n,t,Object.freeze([]))}Je.BREAK=_e;Je.SKIP=mi;Je.REMOVE=nt;function je(n,e,t,s){const i=yi(n,e,t,s);if(U(i)||V(i))return bi(n,s,i),je(n,i,t,s);if(typeof i!="symbol"){if(R(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){const o=je(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===_e)return _e;o===nt&&(e.items.splice(r,1),r-=1)}}}else if(V(e)){s=Object.freeze(s.concat(e));const r=je("key",e.key,t,s);if(r===_e)return _e;r===nt&&(e.key=null);const o=je("value",e.value,t,s);if(o===_e)return _e;o===nt&&(e.value=null)}}return i}function gi(n){return typeof n=="object"&&(n.Collection||n.Node||n.Value)?Object.assign({Alias:n.Node,Map:n.Node,Scalar:n.Node,Seq:n.Node},n.Value&&{Map:n.Value,Scalar:n.Value,Seq:n.Value},n.Collection&&{Map:n.Collection,Seq:n.Collection},n):n}function yi(n,e,t,s){var i,r,o,l,c;if(typeof t=="function")return t(n,e,s);if(at(e))return(i=t.Map)==null?void 0:i.call(t,n,e,s);if(ct(e))return(r=t.Seq)==null?void 0:r.call(t,n,e,s);if(V(e))return(o=t.Pair)==null?void 0:o.call(t,n,e,s);if(D(e))return(l=t.Scalar)==null?void 0:l.call(t,n,e,s);if($e(e))return(c=t.Alias)==null?void 0:c.call(t,n,e,s)}function bi(n,e,t){const s=e[e.length-1];if(R(s))s.items[n]=t;else if(V(s))n==="key"?s.key=t:s.value=t;else if(Lt(s))s.contents=t;else{const i=$e(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}const wi={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},_i=n=>n.replace(/[!,[\]{}]/g,e=>wi[e]);class x{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},x.defaultYaml,e),this.tags=Object.assign({},x.defaultTags,t)}clone(){const e=new x(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new x(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:x.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},x.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:x.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},x.defaultTags),this.atNextDocument=!1);const s=e.trim().split(/[ \t]+/),i=s.shift();switch(i){case"%TAG":{if(s.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;const[r,o]=s;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[r]=s;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const o=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,o),!1}}default:return t(0,`Unknown directive ${i}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const o=e.slice(2,-1);return o==="!"||o==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),o)}const[,s,i]=e.match(/^(.*!)([^!]*)$/s);i||t(`The ${e} tag has no suffix`);const r=this.tags[s];if(r)try{return r+decodeURIComponent(i)}catch(o){return t(String(o)),null}return s==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,s]of Object.entries(this.tags))if(e.startsWith(s))return t+_i(e.substring(s.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags);let i;if(e&&s.length>0&&U(e.contents)){const r={};Je(e.contents,(o,l)=>{U(l)&&l.tag&&(r[l.tag]=!0)}),i=Object.keys(r)}else i=[];for(const[r,o]of s)r==="!!"&&o==="tag:yaml.org,2002:"||(!e||i.some(l=>l.startsWith(o)))&&t.push(`%TAG ${r} ${o}`);return t.join(`
`)}}x.defaultYaml={explicit:!1,version:"1.2"};x.defaultTags={"!!":"tag:yaml.org,2002:"};function cs(n){if(/[\x00-\x19\s,[\]{}]/.test(n)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(n)}`;throw new Error(t)}return!0}function fs(n){const e=new Set;return Je(n,{Value(t,s){s.anchor&&e.add(s.anchor)}}),e}function us(n,e){for(let t=1;;++t){const s=`${n}${t}`;if(!e.has(s))return s}}function vi(n,e){const t=[],s=new Map;let i=null;return{onAnchor:r=>{t.push(r),i??(i=fs(n));const o=us(e,i);return i.add(o),o},setAnchors:()=>{for(const r of t){const o=s.get(r);if(typeof o=="object"&&o.anchor&&(D(o.node)||R(o.node)))o.node.anchor=o.anchor;else{const l=new Error("Failed to resolve repeated object (this should not happen)");throw l.source=r,l}}},sourceObjects:s}}function Fe(n,e,t,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let i=0,r=s.length;i<r;++i){const o=s[i],l=Fe(n,s,String(i),o);l===void 0?delete s[i]:l!==o&&(s[i]=l)}else if(s instanceof Map)for(const i of Array.from(s.keys())){const r=s.get(i),o=Fe(n,s,i,r);o===void 0?s.delete(i):o!==r&&s.set(i,o)}else if(s instanceof Set)for(const i of Array.from(s)){const r=Fe(n,s,i,i);r===void 0?s.delete(i):r!==i&&(s.delete(i),s.add(r))}else for(const[i,r]of Object.entries(s)){const o=Fe(n,s,i,r);o===void 0?delete s[i]:o!==r&&(s[i]=o)}return n.call(e,t,s)}function re(n,e,t){if(Array.isArray(n))return n.map((s,i)=>re(s,String(i),t));if(n&&typeof n.toJSON=="function"){if(!t||!as(n))return n.toJSON(e,t);const s={aliasCount:0,count:1,res:void 0};t.anchors.set(n,s),t.onCreate=r=>{s.res=r,delete t.onCreate};const i=n.toJSON(e,t);return t.onCreate&&t.onCreate(i),i}return typeof n=="bigint"&&!(t!=null&&t.keep)?Number(n):n}class ln{constructor(e){Object.defineProperty(this,oe,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:s,onAnchor:i,reviver:r}={}){if(!Lt(e))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},l=re(this,"",o);if(typeof i=="function")for(const{count:c,res:a}of o.anchors.values())i(a,c);return typeof r=="function"?Fe(r,{"":l},"",l):l}}class an extends ln{constructor(e){super(on),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let s;t!=null&&t.aliasResolveCache?s=t.aliasResolveCache:(s=[],Je(e,{Node:(r,o)=>{($e(o)||as(o))&&s.push(o)}}),t&&(t.aliasResolveCache=s));let i;for(const r of s){if(r===this)break;r.anchor===this.source&&(i=r)}return i}toJSON(e,t){if(!t)return{source:this.source};const{anchors:s,doc:i,maxAliasCount:r}=t,o=this.resolve(i,t);if(!o){const c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let l=s.get(o);if(l||(re(o,null,t),l=s.get(o)),(l==null?void 0:l.res)===void 0){const c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(r>=0&&(l.count+=1,l.aliasCount===0&&(l.aliasCount=_t(i,o,s)),l.count*l.aliasCount>r)){const c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return l.res}toString(e,t,s){const i=`*${this.source}`;if(e){if(cs(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${i} `}return i}}function _t(n,e,t){if($e(e)){const s=e.resolve(n),i=t&&s&&t.get(s);return i?i.count*i.aliasCount:0}else if(R(e)){let s=0;for(const i of e.items){const r=_t(n,i,t);r>s&&(s=r)}return s}else if(V(e)){const s=_t(n,e.key,t),i=_t(n,e.value,t);return Math.max(s,i)}return 1}const hs=n=>!n||typeof n!="function"&&typeof n!="object";class $ extends ln{constructor(e){super(fe),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:re(this.value,e,t)}toString(){return String(this.value)}}$.BLOCK_FOLDED="BLOCK_FOLDED";$.BLOCK_LITERAL="BLOCK_LITERAL";$.PLAIN="PLAIN";$.QUOTE_DOUBLE="QUOTE_DOUBLE";$.QUOTE_SINGLE="QUOTE_SINGLE";const ki="tag:yaml.org,2002:";function Si(n,e,t){if(e){const s=t.filter(r=>r.tag===e),i=s.find(r=>!r.format)??s[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return t.find(s=>{var i;return((i=s.identify)==null?void 0:i.call(s,n))&&!s.format})}function rt(n,e,t){var f,d,p;if(Lt(n)&&(n=n.contents),U(n))return n;if(V(n)){const g=(d=(f=t.schema[be]).createNode)==null?void 0:d.call(f,t.schema,null,t);return g.items.push(n),g}(n instanceof String||n instanceof Number||n instanceof Boolean||typeof BigInt<"u"&&n instanceof BigInt)&&(n=n.valueOf());const{aliasDuplicateObjects:s,onAnchor:i,onTagObj:r,schema:o,sourceObjects:l}=t;let c;if(s&&n&&typeof n=="object"){if(c=l.get(n),c)return c.anchor??(c.anchor=i(n)),new an(c.anchor);c={anchor:null,node:null},l.set(n,c)}e!=null&&e.startsWith("!!")&&(e=ki+e.slice(2));let a=Si(n,e,o.tags);if(!a){if(n&&typeof n.toJSON=="function"&&(n=n.toJSON()),!n||typeof n!="object"){const g=new $(n);return c&&(c.node=g),g}a=n instanceof Map?o[be]:Symbol.iterator in Object(n)?o[ze]:o[be]}r&&(r(a),delete t.onTagObj);const u=a!=null&&a.createNode?a.createNode(t.schema,n,t):typeof((p=a==null?void 0:a.nodeClass)==null?void 0:p.from)=="function"?a.nodeClass.from(t.schema,n,t):new $(n);return e?u.tag=e:a.default||(u.tag=a.tag),c&&(c.node=u),u}function Et(n,e,t){let s=t;for(let i=e.length-1;i>=0;--i){const r=e[i];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const o=[];o[r]=s,s=o}else s=new Map([[r,s]])}return rt(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:n,sourceObjects:new Map})}const xe=n=>n==null||typeof n=="object"&&!!n[Symbol.iterator]().next().done;class ds extends ln{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(s=>U(s)||V(s)?s.clone(e):s),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(xe(e))this.add(t);else{const[s,...i]=e,r=this.get(s,!0);if(R(r))r.addIn(i,t);else if(r===void 0&&this.schema)this.set(s,Et(this.schema,i,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}deleteIn(e){const[t,...s]=e;if(s.length===0)return this.delete(t);const i=this.get(t,!0);if(R(i))return i.deleteIn(s);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${s}`)}getIn(e,t){const[s,...i]=e,r=this.get(s,!0);return i.length===0?!t&&D(r)?r.value:r:R(r)?r.getIn(i,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!V(t))return!1;const s=t.value;return s==null||e&&D(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(e){const[t,...s]=e;if(s.length===0)return this.has(t);const i=this.get(t,!0);return R(i)?i.hasIn(s):!1}setIn(e,t){const[s,...i]=e;if(i.length===0)this.set(s,t);else{const r=this.get(s,!0);if(R(r))r.setIn(i,t);else if(r===void 0&&this.schema)this.set(s,Et(this.schema,i,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}}const Ni=n=>n.replace(/^(?!$)(?: $)?/gm,"#");function pe(n,e){return/^\n+$/.test(n)?n.substring(1):e?n.replace(/^(?! *$)/gm,e):n}const ke=(n,e,t)=>n.endsWith(`
`)?pe(t,e):t.includes(`
`)?`
`+pe(t,e):(n.endsWith(" ")?"":" ")+t,ps="flow",xt="block",vt="quoted";function Ct(n,e,t="flow",{indentAtStart:s,lineWidth:i=80,minContentWidth:r=20,onFold:o,onOverflow:l}={}){if(!i||i<0)return n;i<r&&(r=0);const c=Math.max(1+r,1+i-e.length);if(n.length<=c)return n;const a=[],u={};let f=i-e.length;typeof s=="number"&&(s>i-Math.max(2,r)?a.push(0):f=i-s);let d,p,g=!1,h=-1,m=-1,y=-1;t===xt&&(h=$n(n,h,e.length),h!==-1&&(f=h+c));for(let N;N=n[h+=1];){if(t===vt&&N==="\\"){switch(m=h,n[h+1]){case"x":h+=3;break;case"u":h+=5;break;case"U":h+=9;break;default:h+=1}y=h}if(N===`
`)t===xt&&(h=$n(n,h,e.length)),f=h+e.length+c,d=void 0;else{if(N===" "&&p&&p!==" "&&p!==`
`&&p!=="	"){const S=n[h+1];S&&S!==" "&&S!==`
`&&S!=="	"&&(d=h)}if(h>=f)if(d)a.push(d),f=d+c,d=void 0;else if(t===vt){for(;p===" "||p==="	";)p=N,N=n[h+=1],g=!0;const S=h>y+1?h-2:m-1;if(u[S])return n;a.push(S),u[S]=!0,f=S+c,d=void 0}else g=!0}p=N}if(g&&l&&l(),a.length===0)return n;o&&o();let k=n.slice(0,a[0]);for(let N=0;N<a.length;++N){const S=a[N],E=a[N+1]||n.length;S===0?k=`
${e}${n.slice(0,E)}`:(t===vt&&u[S]&&(k+=`${n[S]}\\`),k+=`
${e}${n.slice(S+1,E)}`)}return k}function $n(n,e,t){let s=e,i=e+1,r=n[i];for(;r===" "||r==="	";)if(e<i+t)r=n[++e];else{do r=n[++e];while(r&&r!==`
`);s=e,i=e+1,r=n[i]}return s}const Mt=(n,e)=>({indentAtStart:e?n.indent.length:n.indentAtStart,lineWidth:n.options.lineWidth,minContentWidth:n.options.minContentWidth}),Dt=n=>/^(%|---|\.\.\.)/m.test(n);function Ei(n,e,t){if(!e||e<0)return!1;const s=e-t,i=n.length;if(i<=s)return!1;for(let r=0,o=0;r<i;++r)if(n[r]===`
`){if(r-o>s)return!0;if(o=r+1,i-o<=s)return!1}return!0}function st(n,e){const t=JSON.stringify(n);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:s}=e,i=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(Dt(n)?"  ":"");let o="",l=0;for(let c=0,a=t[c];a;a=t[++c])if(a===" "&&t[c+1]==="\\"&&t[c+2]==="n"&&(o+=t.slice(l,c)+"\\ ",c+=1,l=c,a="\\"),a==="\\")switch(t[c+1]){case"u":{o+=t.slice(l,c);const u=t.substr(c+2,4);switch(u){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:u.substr(0,2)==="00"?o+="\\x"+u.substr(2):o+=t.substr(c,6)}c+=5,l=c+1}break;case"n":if(s||t[c+2]==='"'||t.length<i)c+=1;else{for(o+=t.slice(l,c)+`

`;t[c+2]==="\\"&&t[c+3]==="n"&&t[c+4]!=='"';)o+=`
`,c+=2;o+=r,t[c+2]===" "&&(o+="\\"),c+=1,l=c+1}break;default:c+=1}return o=l?o+t.slice(l):t,s?o:Ct(o,r,vt,Mt(e,!1))}function en(n,e){if(e.options.singleQuote===!1||e.implicitKey&&n.includes(`
`)||/[ \t]\n|\n[ \t]/.test(n))return st(n,e);const t=e.indent||(Dt(n)?"  ":""),s="'"+n.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?s:Ct(s,t,ps,Mt(e,!1))}function Ke(n,e){const{singleQuote:t}=e.options;let s;if(t===!1)s=st;else{const i=n.includes('"'),r=n.includes("'");i&&!r?s=en:r&&!i?s=st:s=t?en:st}return s(n,e)}let tn;try{tn=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{tn=/\n+(?!\n|$)/g}function kt({comment:n,type:e,value:t},s,i,r){const{blockQuote:o,commentString:l,lineWidth:c}=s.options;if(!o||/\n[\t ]+$/.test(t))return Ke(t,s);const a=s.indent||(s.forceBlockIndent||Dt(t)?"  ":""),u=o==="literal"?!0:o==="folded"||e===$.BLOCK_FOLDED?!1:e===$.BLOCK_LITERAL?!0:!Ei(t,c,a.length);if(!t)return u?`|
`:`>
`;let f,d;for(d=t.length;d>0;--d){const E=t[d-1];if(E!==`
`&&E!=="	"&&E!==" ")break}let p=t.substring(d);const g=p.indexOf(`
`);g===-1?f="-":t===p||g!==p.length-1?(f="+",r&&r()):f="",p&&(t=t.slice(0,-p.length),p[p.length-1]===`
`&&(p=p.slice(0,-1)),p=p.replace(tn,`$&${a}`));let h=!1,m,y=-1;for(m=0;m<t.length;++m){const E=t[m];if(E===" ")h=!0;else if(E===`
`)y=m;else break}let k=t.substring(0,y<m?y+1:m);k&&(t=t.substring(k.length),k=k.replace(/\n+/g,`$&${a}`));let S=(h?a?"2":"1":"")+f;if(n&&(S+=" "+l(n.replace(/ ?[\r\n]+/g," ")),i&&i()),!u){const E=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${a}`);let T=!1;const b=Mt(s,!0);o!=="folded"&&e!==$.BLOCK_FOLDED&&(b.onOverflow=()=>{T=!0});const _=Ct(`${k}${E}${p}`,a,xt,b);if(!T)return`>${S}
${a}${_}`}return t=t.replace(/\n+/g,`$&${a}`),`|${S}
${a}${k}${t}${p}`}function Ii(n,e,t,s){const{type:i,value:r}=n,{actualString:o,implicitKey:l,indent:c,indentStep:a,inFlow:u}=e;if(l&&r.includes(`
`)||u&&/[[\]{},]/.test(r))return Ke(r,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return l||u||!r.includes(`
`)?Ke(r,e):kt(n,e,t,s);if(!l&&!u&&i!==$.PLAIN&&r.includes(`
`))return kt(n,e,t,s);if(Dt(r)){if(c==="")return e.forceBlockIndent=!0,kt(n,e,t,s);if(l&&c===a)return Ke(r,e)}const f=r.replace(/\n+/g,`$&
${c}`);if(o){const d=h=>{var m;return h.default&&h.tag!=="tag:yaml.org,2002:str"&&((m=h.test)==null?void 0:m.test(f))},{compat:p,tags:g}=e.doc.schema;if(g.some(d)||p!=null&&p.some(d))return Ke(r,e)}return l?f:Ct(f,c,ps,Mt(e,!1))}function cn(n,e,t,s){const{implicitKey:i,inFlow:r}=e,o=typeof n.value=="string"?n:Object.assign({},n,{value:String(n.value)});let{type:l}=n;l!==$.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(l=$.QUOTE_DOUBLE);const c=u=>{switch(u){case $.BLOCK_FOLDED:case $.BLOCK_LITERAL:return i||r?Ke(o.value,e):kt(o,e,t,s);case $.QUOTE_DOUBLE:return st(o.value,e);case $.QUOTE_SINGLE:return en(o.value,e);case $.PLAIN:return Ii(o,e,t,s);default:return null}};let a=c(l);if(a===null){const{defaultKeyType:u,defaultStringType:f}=e.options,d=i&&u||f;if(a=c(d),a===null)throw new Error(`Unsupported default string type ${d}`)}return a}function ms(n,e){const t=Object.assign({blockQuote:!0,commentString:Ni,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},n.schema.toStringOptions,e);let s;switch(t.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:n,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:s,options:t}}function Oi(n,e){var i;if(e.tag){const r=n.filter(o=>o.tag===e.tag);if(r.length>0)return r.find(o=>o.format===e.format)??r[0]}let t,s;if(D(e)){s=e.value;let r=n.filter(o=>{var l;return(l=o.identify)==null?void 0:l.call(o,s)});if(r.length>1){const o=r.filter(l=>l.test);o.length>0&&(r=o)}t=r.find(o=>o.format===e.format)??r.find(o=>!o.format)}else s=e,t=n.find(r=>r.nodeClass&&s instanceof r.nodeClass);if(!t){const r=((i=s==null?void 0:s.constructor)==null?void 0:i.name)??(s===null?"null":typeof s);throw new Error(`Tag not resolved for ${r} value`)}return t}function $i(n,e,{anchors:t,doc:s}){if(!s.directives)return"";const i=[],r=(D(n)||R(n))&&n.anchor;r&&cs(r)&&(t.add(r),i.push(`&${r}`));const o=n.tag??(e.default?null:e.tag);return o&&i.push(s.directives.tagString(o)),i.join(" ")}function Ve(n,e,t,s){var c;if(V(n))return n.toString(e,t,s);if($e(n)){if(e.doc.directives)return n.toString(e);if((c=e.resolvedAliases)!=null&&c.has(n))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(n):e.resolvedAliases=new Set([n]),n=n.resolve(e.doc)}let i;const r=U(n)?n:e.doc.createNode(n,{onTagObj:a=>i=a});i??(i=Oi(e.doc.schema.tags,r));const o=$i(r,i,e);o.length>0&&(e.indentAtStart=(e.indentAtStart??0)+o.length+1);const l=typeof i.stringify=="function"?i.stringify(r,e,t,s):D(r)?cn(r,e,t,s):r.toString(e,t,s);return o?D(r)||l[0]==="{"||l[0]==="["?`${o} ${l}`:`${o}
${e.indent}${l}`:l}function Ti({key:n,value:e},t,s,i){const{allNullValues:r,doc:o,indent:l,indentStep:c,options:{commentString:a,indentSeq:u,simpleKeys:f}}=t;let d=U(n)&&n.comment||null;if(f){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(R(n)||!U(n)&&typeof n=="object"){const b="With simple keys, collection cannot be used as a key value";throw new Error(b)}}let p=!f&&(!n||d&&e==null&&!t.inFlow||R(n)||(D(n)?n.type===$.BLOCK_FOLDED||n.type===$.BLOCK_LITERAL:typeof n=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!p&&(f||!r),indent:l+c});let g=!1,h=!1,m=Ve(n,t,()=>g=!0,()=>h=!0);if(!p&&!t.inFlow&&m.length>1024){if(f)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");p=!0}if(t.inFlow){if(r||e==null)return g&&s&&s(),m===""?"?":p?`? ${m}`:m}else if(r&&!f||e==null&&p)return m=`? ${m}`,d&&!g?m+=ke(m,t.indent,a(d)):h&&i&&i(),m;g&&(d=null),p?(d&&(m+=ke(m,t.indent,a(d))),m=`? ${m}
${l}:`):(m=`${m}:`,d&&(m+=ke(m,t.indent,a(d))));let y,k,N;U(e)?(y=!!e.spaceBefore,k=e.commentBefore,N=e.comment):(y=!1,k=null,N=null,e&&typeof e=="object"&&(e=o.createNode(e))),t.implicitKey=!1,!p&&!d&&D(e)&&(t.indentAtStart=m.length+1),h=!1,!u&&c.length>=2&&!t.inFlow&&!p&&ct(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let S=!1;const E=Ve(e,t,()=>S=!0,()=>h=!0);let T=" ";if(d||y||k){if(T=y?`
`:"",k){const b=a(k);T+=`
${pe(b,t.indent)}`}E===""&&!t.inFlow?T===`
`&&N&&(T=`

`):T+=`
${t.indent}`}else if(!p&&R(e)){const b=E[0],_=E.indexOf(`
`),O=_!==-1,C=t.inFlow??e.flow??e.items.length===0;if(O||!C){let Y=!1;if(O&&(b==="&"||b==="!")){let G=E.indexOf(" ");b==="&"&&G!==-1&&G<_&&E[G+1]==="!"&&(G=E.indexOf(" ",G+1)),(G===-1||_<G)&&(Y=!0)}Y||(T=`
${t.indent}`)}}else(E===""||E[0]===`
`)&&(T="");return m+=T+E,t.inFlow?S&&s&&s():N&&!S?m+=ke(m,t.indent,a(N)):h&&i&&i(),m}function gs(n,e){(n==="debug"||n==="warn")&&console.warn(e)}const ht="<<",me={identify:n=>n===ht||typeof n=="symbol"&&n.description===ht,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new $(Symbol(ht)),{addToJSMap:ys}),stringify:()=>ht},Ai=(n,e)=>(me.identify(e)||D(e)&&(!e.type||e.type===$.PLAIN)&&me.identify(e.value))&&(n==null?void 0:n.doc.schema.tags.some(t=>t.tag===me.tag&&t.default));function ys(n,e,t){if(t=n&&$e(t)?t.resolve(n.doc):t,ct(t))for(const s of t.items)Ut(n,e,s);else if(Array.isArray(t))for(const s of t)Ut(n,e,s);else Ut(n,e,t)}function Ut(n,e,t){const s=n&&$e(t)?t.resolve(n.doc):t;if(!at(s))throw new Error("Merge sources must be maps or map aliases");const i=s.toJSON(null,n,Map);for(const[r,o]of i)e instanceof Map?e.has(r)||e.set(r,o):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}function bs(n,e,{key:t,value:s}){if(U(t)&&t.addToJSMap)t.addToJSMap(n,e,s);else if(Ai(n,t))ys(n,e,s);else{const i=re(t,"",n);if(e instanceof Map)e.set(i,re(s,i,n));else if(e instanceof Set)e.add(i);else{const r=Li(t,i,n),o=re(s,r,n);r in e?Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[r]=o}}return e}function Li(n,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(U(n)&&(t!=null&&t.doc)){const s=ms(t.doc,{});s.anchors=new Set;for(const r of t.anchors.keys())s.anchors.add(r.anchor);s.inFlow=!0,s.inStringifyKey=!0;const i=n.toString(s);if(!t.mapKeyWarned){let r=JSON.stringify(i);r.length>40&&(r=r.substring(0,36)+'..."'),gs(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return i}return JSON.stringify(e)}function fn(n,e,t){const s=rt(n,void 0,t),i=rt(e,void 0,t);return new ee(s,i)}class ee{constructor(e,t=null){Object.defineProperty(this,oe,{value:ls}),this.key=e,this.value=t}clone(e){let{key:t,value:s}=this;return U(t)&&(t=t.clone(e)),U(s)&&(s=s.clone(e)),new ee(t,s)}toJSON(e,t){const s=t!=null&&t.mapAsMap?new Map:{};return bs(t,s,this)}toString(e,t,s){return e!=null&&e.doc?Ti(this,e,t,s):JSON.stringify(this)}}function ws(n,e,t){return(e.inFlow??n.flow?Mi:Ci)(n,e,t)}function Ci({comment:n,items:e},t,{blockItemPrefix:s,flowChars:i,itemIndent:r,onChompKeep:o,onComment:l}){const{indent:c,options:{commentString:a}}=t,u=Object.assign({},t,{indent:r,type:null});let f=!1;const d=[];for(let g=0;g<e.length;++g){const h=e[g];let m=null;if(U(h))!f&&h.spaceBefore&&d.push(""),It(t,d,h.commentBefore,f),h.comment&&(m=h.comment);else if(V(h)){const k=U(h.key)?h.key:null;k&&(!f&&k.spaceBefore&&d.push(""),It(t,d,k.commentBefore,f))}f=!1;let y=Ve(h,u,()=>m=null,()=>f=!0);m&&(y+=ke(y,r,a(m))),f&&m&&(f=!1),d.push(s+y)}let p;if(d.length===0)p=i.start+i.end;else{p=d[0];for(let g=1;g<d.length;++g){const h=d[g];p+=h?`
${c}${h}`:`
`}}return n?(p+=`
`+pe(a(n),c),l&&l()):f&&o&&o(),p}function Mi({items:n},e,{flowChars:t,itemIndent:s}){const{indent:i,indentStep:r,flowCollectionPadding:o,options:{commentString:l}}=e;s+=r;const c=Object.assign({},e,{indent:s,inFlow:!0,type:null});let a=!1,u=0;const f=[];for(let g=0;g<n.length;++g){const h=n[g];let m=null;if(U(h))h.spaceBefore&&f.push(""),It(e,f,h.commentBefore,!1),h.comment&&(m=h.comment);else if(V(h)){const k=U(h.key)?h.key:null;k&&(k.spaceBefore&&f.push(""),It(e,f,k.commentBefore,!1),k.comment&&(a=!0));const N=U(h.value)?h.value:null;N?(N.comment&&(m=N.comment),N.commentBefore&&(a=!0)):h.value==null&&(k!=null&&k.comment)&&(m=k.comment)}m&&(a=!0);let y=Ve(h,c,()=>m=null);g<n.length-1&&(y+=","),m&&(y+=ke(y,s,l(m))),!a&&(f.length>u||y.includes(`
`))&&(a=!0),f.push(y),u=f.length}const{start:d,end:p}=t;if(f.length===0)return d+p;if(!a){const g=f.reduce((h,m)=>h+m.length+2,2);a=e.options.lineWidth>0&&g>e.options.lineWidth}if(a){let g=d;for(const h of f)g+=h?`
${r}${i}${h}`:`
`;return`${g}
${i}${p}`}else return`${d}${o}${f.join(" ")}${o}${p}`}function It({indent:n,options:{commentString:e}},t,s,i){if(s&&i&&(s=s.replace(/^\n+/,"")),s){const r=pe(e(s),n);t.push(r.trimStart())}}function Se(n,e){const t=D(e)?e.value:e;for(const s of n)if(V(s)&&(s.key===e||s.key===t||D(s.key)&&s.key.value===t))return s}class ie extends ds{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(be,e),this.items=[]}static from(e,t,s){const{keepUndefined:i,replacer:r}=s,o=new this(e),l=(c,a)=>{if(typeof r=="function")a=r.call(t,c,a);else if(Array.isArray(r)&&!r.includes(c))return;(a!==void 0||i)&&o.items.push(fn(c,a,s))};if(t instanceof Map)for(const[c,a]of t)l(c,a);else if(t&&typeof t=="object")for(const c of Object.keys(t))l(c,t[c]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,t){var o;let s;V(e)?s=e:!e||typeof e!="object"||!("key"in e)?s=new ee(e,e==null?void 0:e.value):s=new ee(e.key,e.value);const i=Se(this.items,s.key),r=(o=this.schema)==null?void 0:o.sortMapEntries;if(i){if(!t)throw new Error(`Key ${s.key} already set`);D(i.value)&&hs(s.value)?i.value.value=s.value:i.value=s.value}else if(r){const l=this.items.findIndex(c=>r(s,c)<0);l===-1?this.items.push(s):this.items.splice(l,0,s)}else this.items.push(s)}delete(e){const t=Se(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const s=Se(this.items,e),i=s==null?void 0:s.value;return(!t&&D(i)?i.value:i)??void 0}has(e){return!!Se(this.items,e)}set(e,t){this.add(new ee(e,t),!0)}toJSON(e,t,s){const i=s?new s:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(i);for(const r of this.items)bs(t,i,r);return i}toString(e,t,s){if(!e)return JSON.stringify(this);for(const i of this.items)if(!V(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),ws(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:s,onComment:t})}}const He={collection:"map",default:!0,nodeClass:ie,tag:"tag:yaml.org,2002:map",resolve(n,e){return at(n)||e("Expected a mapping for this tag"),n},createNode:(n,e,t)=>ie.from(n,e,t)};class Oe extends ds{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(ze,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=dt(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const s=dt(e);if(typeof s!="number")return;const i=this.items[s];return!t&&D(i)?i.value:i}has(e){const t=dt(e);return typeof t=="number"&&t<this.items.length}set(e,t){const s=dt(e);if(typeof s!="number")throw new Error(`Expected a valid index, not ${e}.`);const i=this.items[s];D(i)&&hs(t)?i.value=t:this.items[s]=t}toJSON(e,t){const s=[];t!=null&&t.onCreate&&t.onCreate(s);let i=0;for(const r of this.items)s.push(re(r,String(i++),t));return s}toString(e,t,s){return e?ws(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:s,onComment:t}):JSON.stringify(this)}static from(e,t,s){const{replacer:i}=s,r=new this(e);if(t&&Symbol.iterator in Object(t)){let o=0;for(let l of t){if(typeof i=="function"){const c=t instanceof Set?l:String(o++);l=i.call(t,c,l)}r.items.push(rt(l,void 0,s))}}return r}}function dt(n){let e=D(n)?n.value:n;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const We={collection:"seq",default:!0,nodeClass:Oe,tag:"tag:yaml.org,2002:seq",resolve(n,e){return ct(n)||e("Expected a sequence for this tag"),n},createNode:(n,e,t)=>Oe.from(n,e,t)},Pt={identify:n=>typeof n=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:n=>n,stringify(n,e,t,s){return e=Object.assign({actualString:!0},e),cn(n,e,t,s)}},Bt={identify:n=>n==null,createNode:()=>new $(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new $(null),stringify:({source:n},e)=>typeof n=="string"&&Bt.test.test(n)?n:e.options.nullStr},un={identify:n=>typeof n=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:n=>new $(n[0]==="t"||n[0]==="T"),stringify({source:n,value:e},t){if(n&&un.test.test(n)){const s=n[0]==="t"||n[0]==="T";if(e===s)return n}return e?t.options.trueStr:t.options.falseStr}};function ae({format:n,minFractionDigits:e,tag:t,value:s}){if(typeof s=="bigint")return String(s);const i=typeof s=="number"?s:Number(s);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let r=Object.is(s,-0)?"-0":JSON.stringify(s);if(!n&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let l=e-(r.length-o-1);for(;l-- >0;)r+="0"}return r}const _s={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ae},vs={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:n=>parseFloat(n),stringify(n){const e=Number(n.value);return isFinite(e)?e.toExponential():ae(n)}},ks={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(n){const e=new $(parseFloat(n)),t=n.indexOf(".");return t!==-1&&n[n.length-1]==="0"&&(e.minFractionDigits=n.length-t-1),e},stringify:ae},jt=n=>typeof n=="bigint"||Number.isInteger(n),hn=(n,e,t,{intAsBigInt:s})=>s?BigInt(n):parseInt(n.substring(e),t);function Ss(n,e,t){const{value:s}=n;return jt(s)&&s>=0?t+s.toString(e):ae(n)}const Ns={identify:n=>jt(n)&&n>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(n,e,t)=>hn(n,2,8,t),stringify:n=>Ss(n,8,"0o")},Es={identify:jt,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(n,e,t)=>hn(n,0,10,t),stringify:ae},Is={identify:n=>jt(n)&&n>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(n,e,t)=>hn(n,2,16,t),stringify:n=>Ss(n,16,"0x")},Di=[He,We,Pt,Bt,un,Ns,Es,Is,_s,vs,ks];function Tn(n){return typeof n=="bigint"||Number.isInteger(n)}const pt=({value:n})=>JSON.stringify(n),Pi=[{identify:n=>typeof n=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:n=>n,stringify:pt},{identify:n=>n==null,createNode:()=>new $(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:pt},{identify:n=>typeof n=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:n=>n==="true",stringify:pt},{identify:Tn,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(n,e,{intAsBigInt:t})=>t?BigInt(n):parseInt(n,10),stringify:({value:n})=>Tn(n)?n.toString():JSON.stringify(n)},{identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:n=>parseFloat(n),stringify:pt}],Bi={default:!0,tag:"",test:/^/,resolve(n,e){return e(`Unresolved plain scalar ${JSON.stringify(n)}`),n}},ji=[He,We].concat(Pi,Bi),dn={identify:n=>n instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(n,e){if(typeof atob=="function"){const t=atob(n.replace(/[\n\r]/g,"")),s=new Uint8Array(t.length);for(let i=0;i<t.length;++i)s[i]=t.charCodeAt(i);return s}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),n},stringify({comment:n,type:e,value:t},s,i,r){if(!t)return"";const o=t;let l;if(typeof btoa=="function"){let c="";for(let a=0;a<o.length;++a)c+=String.fromCharCode(o[a]);l=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=$.BLOCK_LITERAL),e!==$.QUOTE_DOUBLE){const c=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),a=Math.ceil(l.length/c),u=new Array(a);for(let f=0,d=0;f<a;++f,d+=c)u[f]=l.substr(d,c);l=u.join(e===$.BLOCK_LITERAL?`
`:" ")}return cn({comment:n,type:e,value:l},s,i,r)}};function Os(n,e){if(ct(n))for(let t=0;t<n.items.length;++t){let s=n.items[t];if(!V(s)){if(at(s)){s.items.length>1&&e("Each pair must have its own sequence indicator");const i=s.items[0]||new ee(new $(null));if(s.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${s.commentBefore}
${i.key.commentBefore}`:s.commentBefore),s.comment){const r=i.value??i.key;r.comment=r.comment?`${s.comment}
${r.comment}`:s.comment}s=i}n.items[t]=V(s)?s:new ee(s)}}else e("Expected a sequence for this tag");return n}function $s(n,e,t){const{replacer:s}=t,i=new Oe(n);i.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof s=="function"&&(o=s.call(e,String(r++),o));let l,c;if(Array.isArray(o))if(o.length===2)l=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const a=Object.keys(o);if(a.length===1)l=a[0],c=o[l];else throw new TypeError(`Expected tuple with one key, not ${a.length} keys`)}else l=o;i.items.push(fn(l,c,t))}return i}const pn={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Os,createNode:$s};class Re extends Oe{constructor(){super(),this.add=ie.prototype.add.bind(this),this.delete=ie.prototype.delete.bind(this),this.get=ie.prototype.get.bind(this),this.has=ie.prototype.has.bind(this),this.set=ie.prototype.set.bind(this),this.tag=Re.tag}toJSON(e,t){if(!t)return super.toJSON(e);const s=new Map;t!=null&&t.onCreate&&t.onCreate(s);for(const i of this.items){let r,o;if(V(i)?(r=re(i.key,"",t),o=re(i.value,r,t)):r=re(i,"",t),s.has(r))throw new Error("Ordered maps must not include duplicate keys");s.set(r,o)}return s}static from(e,t,s){const i=$s(e,t,s),r=new this;return r.items=i.items,r}}Re.tag="tag:yaml.org,2002:omap";const mn={collection:"seq",identify:n=>n instanceof Map,nodeClass:Re,default:!1,tag:"tag:yaml.org,2002:omap",resolve(n,e){const t=Os(n,e),s=[];for(const{key:i}of t.items)D(i)&&(s.includes(i.value)?e(`Ordered maps must not include duplicate keys: ${i.value}`):s.push(i.value));return Object.assign(new Re,t)},createNode:(n,e,t)=>Re.from(n,e,t)};function Ts({value:n,source:e},t){return e&&(n?As:Ls).test.test(e)?e:n?t.options.trueStr:t.options.falseStr}const As={identify:n=>n===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new $(!0),stringify:Ts},Ls={identify:n=>n===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new $(!1),stringify:Ts},Fi={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:ae},Ki={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:n=>parseFloat(n.replace(/_/g,"")),stringify(n){const e=Number(n.value);return isFinite(e)?e.toExponential():ae(n)}},qi={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(n){const e=new $(parseFloat(n.replace(/_/g,""))),t=n.indexOf(".");if(t!==-1){const s=n.substring(t+1).replace(/_/g,"");s[s.length-1]==="0"&&(e.minFractionDigits=s.length)}return e},stringify:ae},ft=n=>typeof n=="bigint"||Number.isInteger(n);function Ft(n,e,t,{intAsBigInt:s}){const i=n[0];if((i==="-"||i==="+")&&(e+=1),n=n.substring(e).replace(/_/g,""),s){switch(t){case 2:n=`0b${n}`;break;case 8:n=`0o${n}`;break;case 16:n=`0x${n}`;break}const o=BigInt(n);return i==="-"?BigInt(-1)*o:o}const r=parseInt(n,t);return i==="-"?-1*r:r}function gn(n,e,t){const{value:s}=n;if(ft(s)){const i=s.toString(e);return s<0?"-"+t+i.substr(1):t+i}return ae(n)}const Ri={identify:ft,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(n,e,t)=>Ft(n,2,2,t),stringify:n=>gn(n,2,"0b")},Ui={identify:ft,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(n,e,t)=>Ft(n,1,8,t),stringify:n=>gn(n,8,"0")},Vi={identify:ft,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(n,e,t)=>Ft(n,0,10,t),stringify:ae},Yi={identify:ft,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(n,e,t)=>Ft(n,2,16,t),stringify:n=>gn(n,16,"0x")};class Ue extends ie{constructor(e){super(e),this.tag=Ue.tag}add(e){let t;V(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new ee(e.key,null):t=new ee(e,null),Se(this.items,t.key)||this.items.push(t)}get(e,t){const s=Se(this.items,e);return!t&&V(s)?D(s.key)?s.key.value:s.key:s}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const s=Se(this.items,e);s&&!t?this.items.splice(this.items.indexOf(s),1):!s&&t&&this.items.push(new ee(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,s){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,s);throw new Error("Set items must all have null values")}static from(e,t,s){const{replacer:i}=s,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let o of t)typeof i=="function"&&(o=i.call(t,o,o)),r.items.push(fn(o,null,s));return r}}Ue.tag="tag:yaml.org,2002:set";const yn={collection:"map",identify:n=>n instanceof Set,nodeClass:Ue,default:!1,tag:"tag:yaml.org,2002:set",createNode:(n,e,t)=>Ue.from(n,e,t),resolve(n,e){if(at(n)){if(n.hasAllNullValues(!0))return Object.assign(new Ue,n);e("Set items must all have null values")}else e("Expected a mapping for this tag");return n}};function bn(n,e){const t=n[0],s=t==="-"||t==="+"?n.substring(1):n,i=o=>e?BigInt(o):Number(o),r=s.replace(/_/g,"").split(":").reduce((o,l)=>o*i(60)+i(l),i(0));return t==="-"?i(-1)*r:r}function Cs(n){let{value:e}=n,t=o=>o;if(typeof e=="bigint")t=o=>BigInt(o);else if(isNaN(e)||!isFinite(e))return ae(n);let s="";e<0&&(s="-",e*=t(-1));const i=t(60),r=[e%i];return e<60?r.unshift(0):(e=(e-r[0])/i,r.unshift(e%i),e>=60&&(e=(e-r[0])/i,r.unshift(e))),s+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Ms={identify:n=>typeof n=="bigint"||Number.isInteger(n),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(n,e,{intAsBigInt:t})=>bn(n,t),stringify:Cs},Ds={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:n=>bn(n,!1),stringify:Cs},Kt={identify:n=>n instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(n){const e=n.match(Kt.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,s,i,r,o,l]=e.map(Number),c=e[7]?Number((e[7]+"00").substr(1,3)):0;let a=Date.UTC(t,s-1,i,r||0,o||0,l||0,c);const u=e[8];if(u&&u!=="Z"){let f=bn(u,!1);Math.abs(f)<30&&(f*=60),a-=6e4*f}return new Date(a)},stringify:({value:n})=>(n==null?void 0:n.toISOString().replace(/(T00:00:00)?\.000Z$/,""))??""},An=[He,We,Pt,Bt,As,Ls,Ri,Ui,Vi,Yi,Fi,Ki,qi,dn,me,mn,pn,yn,Ms,Ds,Kt],Ln=new Map([["core",Di],["failsafe",[He,We,Pt]],["json",ji],["yaml11",An],["yaml-1.1",An]]),Cn={binary:dn,bool:un,float:ks,floatExp:vs,floatNaN:_s,floatTime:Ds,int:Es,intHex:Is,intOct:Ns,intTime:Ms,map:He,merge:me,null:Bt,omap:mn,pairs:pn,seq:We,set:yn,timestamp:Kt},Gi={"tag:yaml.org,2002:binary":dn,"tag:yaml.org,2002:merge":me,"tag:yaml.org,2002:omap":mn,"tag:yaml.org,2002:pairs":pn,"tag:yaml.org,2002:set":yn,"tag:yaml.org,2002:timestamp":Kt};function Vt(n,e,t){const s=Ln.get(e);if(s&&!n)return t&&!s.includes(me)?s.concat(me):s.slice();let i=s;if(!i)if(Array.isArray(n))i=[];else{const r=Array.from(Ln.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${r} or define customTags array`)}if(Array.isArray(n))for(const r of n)i=i.concat(r);else typeof n=="function"&&(i=n(i.slice()));return t&&(i=i.concat(me)),i.reduce((r,o)=>{const l=typeof o=="string"?Cn[o]:o;if(!l){const c=JSON.stringify(o),a=Object.keys(Cn).map(u=>JSON.stringify(u)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${a}`)}return r.includes(l)||r.push(l),r},[])}const zi=(n,e)=>n.key<e.key?-1:n.key>e.key?1:0;class wn{constructor({compat:e,customTags:t,merge:s,resolveKnownTags:i,schema:r,sortMapEntries:o,toStringDefaults:l}){this.compat=Array.isArray(e)?Vt(e,"compat"):e?Vt(null,e):null,this.name=typeof r=="string"&&r||"core",this.knownTags=i?Gi:{},this.tags=Vt(t,this.name,s),this.toStringOptions=l??null,Object.defineProperty(this,be,{value:He}),Object.defineProperty(this,fe,{value:Pt}),Object.defineProperty(this,ze,{value:We}),this.sortMapEntries=typeof o=="function"?o:o===!0?zi:null}clone(){const e=Object.create(wn.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function Ji(n,e){var c;const t=[];let s=e.directives===!0;if(e.directives!==!1&&n.directives){const a=n.directives.toString(n);a?(t.push(a),s=!0):n.directives.docStart&&(s=!0)}s&&t.push("---");const i=ms(n,e),{commentString:r}=i.options;if(n.commentBefore){t.length!==1&&t.unshift("");const a=r(n.commentBefore);t.unshift(pe(a,""))}let o=!1,l=null;if(n.contents){if(U(n.contents)){if(n.contents.spaceBefore&&s&&t.push(""),n.contents.commentBefore){const f=r(n.contents.commentBefore);t.push(pe(f,""))}i.forceBlockIndent=!!n.comment,l=n.contents.comment}const a=l?void 0:()=>o=!0;let u=Ve(n.contents,i,()=>l=null,a);l&&(u+=ke(u,"",r(l))),(u[0]==="|"||u[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${u}`:t.push(u)}else t.push(Ve(n.contents,i));if((c=n.directives)!=null&&c.docEnd)if(n.comment){const a=r(n.comment);a.includes(`
`)?(t.push("..."),t.push(pe(a,""))):t.push(`... ${a}`)}else t.push("...");else{let a=n.comment;a&&o&&(a=a.replace(/^\n+/,"")),a&&((!o||l)&&t[t.length-1]!==""&&t.push(""),t.push(pe(r(a),"")))}return t.join(`
`)+`
`}class qt{constructor(e,t,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,oe,{value:Zt});let i=null;typeof t=="function"||Array.isArray(t)?i=t:s===void 0&&t&&(s=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=r;let{version:o}=r;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new x({version:o}),this.setSchema(o,s),this.contents=e===void 0?null:this.createNode(e,i,s)}clone(){const e=Object.create(qt.prototype,{[oe]:{value:Zt}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=U(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Ce(this.contents)&&this.contents.add(e)}addIn(e,t){Ce(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const s=fs(this);e.anchor=!t||s.has(t)?us(t||"a",s):t}return new an(e.anchor)}createNode(e,t,s){let i;if(typeof t=="function")e=t.call({"":e},"",e),i=t;else if(Array.isArray(t)){const m=k=>typeof k=="number"||k instanceof String||k instanceof Number,y=t.filter(m).map(String);y.length>0&&(t=t.concat(y)),i=t}else s===void 0&&t&&(s=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:l,keepUndefined:c,onTagObj:a,tag:u}=s??{},{onAnchor:f,setAnchors:d,sourceObjects:p}=vi(this,o||"a"),g={aliasDuplicateObjects:r??!0,keepUndefined:c??!1,onAnchor:f,onTagObj:a,replacer:i,schema:this.schema,sourceObjects:p},h=rt(e,u,g);return l&&R(h)&&(h.flow=!0),d(),h}createPair(e,t,s={}){const i=this.createNode(e,null,s),r=this.createNode(t,null,s);return new ee(i,r)}delete(e){return Ce(this.contents)?this.contents.delete(e):!1}deleteIn(e){return xe(e)?this.contents==null?!1:(this.contents=null,!0):Ce(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return R(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return xe(e)?!t&&D(this.contents)?this.contents.value:this.contents:R(this.contents)?this.contents.getIn(e,t):void 0}has(e){return R(this.contents)?this.contents.has(e):!1}hasIn(e){return xe(e)?this.contents!==void 0:R(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=Et(this.schema,[e],t):Ce(this.contents)&&this.contents.set(e,t)}setIn(e,t){xe(e)?this.contents=t:this.contents==null?this.contents=Et(this.schema,Array.from(e),t):Ce(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let s;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new x({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new x({version:e}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{const i=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(s)this.schema=new wn(Object.assign(s,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:s,maxAliasCount:i,onAnchor:r,reviver:o}={}){const l={anchors:new Map,doc:this,keep:!e,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},c=re(this.contents,t??"",l);if(typeof r=="function")for(const{count:a,res:u}of l.anchors.values())r(u,a);return typeof o=="function"?Fe(o,{"":c},"",c):c}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return Ji(this,e)}}function Ce(n){if(R(n))return!0;throw new Error("Expected a YAML collection as document contents")}class Ps extends Error{constructor(e,t,s,i){super(),this.name=e,this.code=s,this.message=i,this.pos=t}}class et extends Ps{constructor(e,t,s){super("YAMLParseError",e,t,s)}}class Hi extends Ps{constructor(e,t,s){super("YAMLWarning",e,t,s)}}const Mn=(n,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(l=>e.linePos(l));const{line:s,col:i}=t.linePos[0];t.message+=` at line ${s}, column ${i}`;let r=i-1,o=n.substring(e.lineStarts[s-1],e.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){const l=Math.min(r-39,o.length-79);o="â€¦"+o.substring(l),r-=l-1}if(o.length>80&&(o=o.substring(0,79)+"â€¦"),s>1&&/^ *$/.test(o.substring(0,r))){let l=n.substring(e.lineStarts[s-2],e.lineStarts[s-1]);l.length>80&&(l=l.substring(0,79)+`â€¦
`),o=l+o}if(/[^ ]/.test(o)){let l=1;const c=t.linePos[1];(c==null?void 0:c.line)===s&&c.col>i&&(l=Math.max(1,Math.min(c.col-i,80-r)));const a=" ".repeat(r)+"^".repeat(l);t.message+=`:

${o}
${a}
`}};function Ye(n,{flow:e,indicator:t,next:s,offset:i,onError:r,parentIndent:o,startOnNewline:l}){let c=!1,a=l,u=l,f="",d="",p=!1,g=!1,h=null,m=null,y=null,k=null,N=null,S=null,E=null;for(const _ of n)switch(g&&(_.type!=="space"&&_.type!=="newline"&&_.type!=="comma"&&r(_.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g=!1),h&&(a&&_.type!=="comment"&&_.type!=="newline"&&r(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),h=null),_.type){case"space":!e&&(t!=="doc-start"||(s==null?void 0:s.type)!=="flow-collection")&&_.source.includes("	")&&(h=_),u=!0;break;case"comment":{u||r(_,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const O=_.source.substring(1)||" ";f?f+=d+O:f=O,d="",a=!1;break}case"newline":a?f?f+=_.source:(!S||t!=="seq-item-ind")&&(c=!0):d+=_.source,a=!0,p=!0,(m||y)&&(k=_),u=!0;break;case"anchor":m&&r(_,"MULTIPLE_ANCHORS","A node can have at most one anchor"),_.source.endsWith(":")&&r(_.offset+_.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=_,E??(E=_.offset),a=!1,u=!1,g=!0;break;case"tag":{y&&r(_,"MULTIPLE_TAGS","A node can have at most one tag"),y=_,E??(E=_.offset),a=!1,u=!1,g=!0;break}case t:(m||y)&&r(_,"BAD_PROP_ORDER",`Anchors and tags must be after the ${_.source} indicator`),S&&r(_,"UNEXPECTED_TOKEN",`Unexpected ${_.source} in ${e??"collection"}`),S=_,a=t==="seq-item-ind"||t==="explicit-key-ind",u=!1;break;case"comma":if(e){N&&r(_,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),N=_,a=!1,u=!1;break}default:r(_,"UNEXPECTED_TOKEN",`Unexpected ${_.type} token`),a=!1,u=!1}const T=n[n.length-1],b=T?T.offset+T.source.length:i;return g&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h&&(a&&h.indent<=o||(s==null?void 0:s.type)==="block-map"||(s==null?void 0:s.type)==="block-seq")&&r(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:N,found:S,spaceBefore:c,comment:f,hasNewline:p,anchor:m,tag:y,newlineAfterProp:k,end:b,start:E??b}}function ot(n){if(!n)return null;switch(n.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(n.source.includes(`
`))return!0;if(n.end){for(const e of n.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of n.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(ot(e.key)||ot(e.value))return!0}return!1;default:return!0}}function nn(n,e,t){if((e==null?void 0:e.type)==="flow-collection"){const s=e.end[0];s.indent===n&&(s.source==="]"||s.source==="}")&&ot(e)&&t(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Bs(n,e,t){const{uniqueKeys:s}=n.options;if(s===!1)return!1;const i=typeof s=="function"?s:(r,o)=>r===o||D(r)&&D(o)&&r.value===o.value;return e.some(r=>i(r.key,t))}const Dn="All mapping items must start at the same column";function Wi({composeNode:n,composeEmptyNode:e},t,s,i,r){var u;const o=(r==null?void 0:r.nodeClass)??ie,l=new o(t.schema);t.atRoot&&(t.atRoot=!1);let c=s.offset,a=null;for(const f of s.items){const{start:d,key:p,sep:g,value:h}=f,m=Ye(d,{indicator:"explicit-key-ind",next:p??(g==null?void 0:g[0]),offset:c,onError:i,parentIndent:s.indent,startOnNewline:!0}),y=!m.found;if(y){if(p&&(p.type==="block-seq"?i(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in p&&p.indent!==s.indent&&i(c,"BAD_INDENT",Dn)),!m.anchor&&!m.tag&&!g){a=m.end,m.comment&&(l.comment?l.comment+=`
`+m.comment:l.comment=m.comment);continue}(m.newlineAfterProp||ot(p))&&i(p??d[d.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((u=m.found)==null?void 0:u.indent)!==s.indent&&i(c,"BAD_INDENT",Dn);t.atKey=!0;const k=m.end,N=p?n(t,p,m,i):e(t,k,d,null,m,i);t.schema.compat&&nn(s.indent,p,i),t.atKey=!1,Bs(t,l.items,N)&&i(k,"DUPLICATE_KEY","Map keys must be unique");const S=Ye(g??[],{indicator:"map-value-ind",next:h,offset:N.range[2],onError:i,parentIndent:s.indent,startOnNewline:!p||p.type==="block-scalar"});if(c=S.end,S.found){y&&((h==null?void 0:h.type)==="block-map"&&!S.hasNewline&&i(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&m.start<S.found.offset-1024&&i(N.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const E=h?n(t,h,S,i):e(t,c,g,null,S,i);t.schema.compat&&nn(s.indent,h,i),c=E.range[2];const T=new ee(N,E);t.options.keepSourceTokens&&(T.srcToken=f),l.items.push(T)}else{y&&i(N.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),S.comment&&(N.comment?N.comment+=`
`+S.comment:N.comment=S.comment);const E=new ee(N);t.options.keepSourceTokens&&(E.srcToken=f),l.items.push(E)}}return a&&a<c&&i(a,"IMPOSSIBLE","Map comment with trailing content"),l.range=[s.offset,c,a??c],l}function Qi({composeNode:n,composeEmptyNode:e},t,s,i,r){const o=(r==null?void 0:r.nodeClass)??Oe,l=new o(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let c=s.offset,a=null;for(const{start:u,value:f}of s.items){const d=Ye(u,{indicator:"seq-item-ind",next:f,offset:c,onError:i,parentIndent:s.indent,startOnNewline:!0});if(!d.found)if(d.anchor||d.tag||f)(f==null?void 0:f.type)==="block-seq"?i(d.end,"BAD_INDENT","All sequence items must start at the same column"):i(c,"MISSING_CHAR","Sequence item without - indicator");else{a=d.end,d.comment&&(l.comment=d.comment);continue}const p=f?n(t,f,d,i):e(t,d.end,u,null,d,i);t.schema.compat&&nn(s.indent,f,i),c=p.range[2],l.items.push(p)}return l.range=[s.offset,c,a??c],l}function ut(n,e,t,s){let i="";if(n){let r=!1,o="";for(const l of n){const{source:c,type:a}=l;switch(a){case"space":r=!0;break;case"comment":{t&&!r&&s(l,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const u=c.substring(1)||" ";i?i+=o+u:i=u,o="";break}case"newline":i&&(o+=c),r=!0;break;default:s(l,"UNEXPECTED_TOKEN",`Unexpected ${a} at node end`)}e+=c.length}}return{comment:i,offset:e}}const Yt="Block collections are not allowed within flow collections",Gt=n=>n&&(n.type==="block-map"||n.type==="block-seq");function Xi({composeNode:n,composeEmptyNode:e},t,s,i,r){var m;const o=s.start.source==="{",l=o?"flow map":"flow sequence",c=(r==null?void 0:r.nodeClass)??(o?ie:Oe),a=new c(t.schema);a.flow=!0;const u=t.atRoot;u&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let f=s.offset+s.start.source.length;for(let y=0;y<s.items.length;++y){const k=s.items[y],{start:N,key:S,sep:E,value:T}=k,b=Ye(N,{flow:l,indicator:"explicit-key-ind",next:S??(E==null?void 0:E[0]),offset:f,onError:i,parentIndent:s.indent,startOnNewline:!1});if(!b.found){if(!b.anchor&&!b.tag&&!E&&!T){y===0&&b.comma?i(b.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`):y<s.items.length-1&&i(b.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${l}`),b.comment&&(a.comment?a.comment+=`
`+b.comment:a.comment=b.comment),f=b.end;continue}!o&&t.options.strict&&ot(S)&&i(S,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(y===0)b.comma&&i(b.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${l}`);else if(b.comma||i(b.start,"MISSING_CHAR",`Missing , between ${l} items`),b.comment){let _="";e:for(const O of N)switch(O.type){case"comma":case"space":break;case"comment":_=O.source.substring(1);break e;default:break e}if(_){let O=a.items[a.items.length-1];V(O)&&(O=O.value??O.key),O.comment?O.comment+=`
`+_:O.comment=_,b.comment=b.comment.substring(_.length+1)}}if(!o&&!E&&!b.found){const _=T?n(t,T,b,i):e(t,b.end,E,null,b,i);a.items.push(_),f=_.range[2],Gt(T)&&i(_.range,"BLOCK_IN_FLOW",Yt)}else{t.atKey=!0;const _=b.end,O=S?n(t,S,b,i):e(t,_,N,null,b,i);Gt(S)&&i(O.range,"BLOCK_IN_FLOW",Yt),t.atKey=!1;const C=Ye(E??[],{flow:l,indicator:"map-value-ind",next:T,offset:O.range[2],onError:i,parentIndent:s.indent,startOnNewline:!1});if(C.found){if(!o&&!b.found&&t.options.strict){if(E)for(const F of E){if(F===C.found)break;if(F.type==="newline"){i(F,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}b.start<C.found.offset-1024&&i(C.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else T&&("source"in T&&((m=T.source)==null?void 0:m[0])===":"?i(T,"MISSING_CHAR",`Missing space after : in ${l}`):i(C.start,"MISSING_CHAR",`Missing , or : between ${l} items`));const Y=T?n(t,T,C,i):C.found?e(t,C.end,E,null,C,i):null;Y?Gt(T)&&i(Y.range,"BLOCK_IN_FLOW",Yt):C.comment&&(O.comment?O.comment+=`
`+C.comment:O.comment=C.comment);const G=new ee(O,Y);if(t.options.keepSourceTokens&&(G.srcToken=k),o){const F=a;Bs(t,F.items,O)&&i(_,"DUPLICATE_KEY","Map keys must be unique"),F.items.push(G)}else{const F=new ie(t.schema);F.flow=!0,F.items.push(G);const X=(Y??O).range;F.range=[O.range[0],X[1],X[2]],a.items.push(F)}f=Y?Y.range[2]:C.end}}const d=o?"}":"]",[p,...g]=s.end;let h=f;if((p==null?void 0:p.source)===d)h=p.offset+p.source.length;else{const y=l[0].toUpperCase()+l.substring(1),k=u?`${y} must end with a ${d}`:`${y} in block collection must be sufficiently indented and end with a ${d}`;i(f,u?"MISSING_CHAR":"BAD_INDENT",k),p&&p.source.length!==1&&g.unshift(p)}if(g.length>0){const y=ut(g,h,t.options.strict,i);y.comment&&(a.comment?a.comment+=`
`+y.comment:a.comment=y.comment),a.range=[s.offset,h,y.offset]}else a.range=[s.offset,h,h];return a}function zt(n,e,t,s,i,r){const o=t.type==="block-map"?Wi(n,e,t,s,r):t.type==="block-seq"?Qi(n,e,t,s,r):Xi(n,e,t,s,r),l=o.constructor;return i==="!"||i===l.tagName?(o.tag=l.tagName,o):(i&&(o.tag=i),o)}function Zi(n,e,t,s,i){var d;const r=s.tag,o=r?e.directives.tagName(r.source,p=>i(r,"TAG_RESOLVE_FAILED",p)):null;if(t.type==="block-seq"){const{anchor:p,newlineAfterProp:g}=s,h=p&&r?p.offset>r.offset?p:r:p??r;h&&(!g||g.offset<h.offset)&&i(h,"MISSING_CHAR","Missing newline after block sequence props")}const l=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!o||o==="!"||o===ie.tagName&&l==="map"||o===Oe.tagName&&l==="seq")return zt(n,e,t,i,o);let c=e.schema.tags.find(p=>p.tag===o&&p.collection===l);if(!c){const p=e.schema.knownTags[o];if((p==null?void 0:p.collection)===l)e.schema.tags.push(Object.assign({},p,{default:!1})),c=p;else return p?i(r,"BAD_COLLECTION_TYPE",`${p.tag} used for ${l} collection, but expects ${p.collection??"scalar"}`,!0):i(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),zt(n,e,t,i,o)}const a=zt(n,e,t,i,o,c),u=((d=c.resolve)==null?void 0:d.call(c,a,p=>i(r,"TAG_RESOLVE_FAILED",p),e.options))??a,f=U(u)?u:new $(u);return f.range=a.range,f.tag=o,c!=null&&c.format&&(f.format=c.format),f}function xi(n,e,t){const s=e.offset,i=er(e,n.options.strict,t);if(!i)return{value:"",type:null,comment:"",range:[s,s,s]};const r=i.mode===">"?$.BLOCK_FOLDED:$.BLOCK_LITERAL,o=e.source?tr(e.source):[];let l=o.length;for(let h=o.length-1;h>=0;--h){const m=o[h][1];if(m===""||m==="\r")l=h;else break}if(l===0){const h=i.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let m=s+i.length;return e.source&&(m+=e.source.length),{value:h,type:r,comment:i.comment,range:[s,m,m]}}let c=e.indent+i.indent,a=e.offset+i.length,u=0;for(let h=0;h<l;++h){const[m,y]=o[h];if(y===""||y==="\r")i.indent===0&&m.length>c&&(c=m.length);else{m.length<c&&t(a+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),i.indent===0&&(c=m.length),u=h,c===0&&!n.atRoot&&t(a,"BAD_INDENT","Block scalar values in collections must be indented");break}a+=m.length+y.length+1}for(let h=o.length-1;h>=l;--h)o[h][0].length>c&&(l=h+1);let f="",d="",p=!1;for(let h=0;h<u;++h)f+=o[h][0].slice(c)+`
`;for(let h=u;h<l;++h){let[m,y]=o[h];a+=m.length+y.length+1;const k=y[y.length-1]==="\r";if(k&&(y=y.slice(0,-1)),y&&m.length<c){const S=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;t(a-y.length-(k?2:1),"BAD_INDENT",S),m=""}r===$.BLOCK_LITERAL?(f+=d+m.slice(c)+y,d=`
`):m.length>c||y[0]==="	"?(d===" "?d=`
`:!p&&d===`
`&&(d=`

`),f+=d+m.slice(c)+y,d=`
`,p=!0):y===""?d===`
`?f+=`
`:d=`
`:(f+=d+y,d=" ",p=!1)}switch(i.chomp){case"-":break;case"+":for(let h=l;h<o.length;++h)f+=`
`+o[h][0].slice(c);f[f.length-1]!==`
`&&(f+=`
`);break;default:f+=`
`}const g=s+i.length+e.source.length;return{value:f,type:r,comment:i.comment,range:[s,g,g]}}function er({offset:n,props:e},t,s){if(e[0].type!=="block-scalar-header")return s(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:i}=e[0],r=i[0];let o=0,l="",c=-1;for(let d=1;d<i.length;++d){const p=i[d];if(!l&&(p==="-"||p==="+"))l=p;else{const g=Number(p);!o&&g?o=g:c===-1&&(c=n+d)}}c!==-1&&s(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let a=!1,u="",f=i.length;for(let d=1;d<e.length;++d){const p=e[d];switch(p.type){case"space":a=!0;case"newline":f+=p.source.length;break;case"comment":t&&!a&&s(p,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),f+=p.source.length,u=p.source.substring(1);break;case"error":s(p,"UNEXPECTED_TOKEN",p.message),f+=p.source.length;break;default:{const g=`Unexpected token in block scalar header: ${p.type}`;s(p,"UNEXPECTED_TOKEN",g);const h=p.source;h&&typeof h=="string"&&(f+=h.length)}}}return{mode:r,indent:o,chomp:l,comment:u,length:f}}function tr(n){const e=n.split(/\n( *)/),t=e[0],s=t.match(/^( *)/),r=[s!=null&&s[1]?[s[1],t.slice(s[1].length)]:["",t]];for(let o=1;o<e.length;o+=2)r.push([e[o],e[o+1]]);return r}function nr(n,e,t){const{offset:s,type:i,source:r,end:o}=n;let l,c;const a=(d,p,g)=>t(s+d,p,g);switch(i){case"scalar":l=$.PLAIN,c=sr(r,a);break;case"single-quoted-scalar":l=$.QUOTE_SINGLE,c=ir(r,a);break;case"double-quoted-scalar":l=$.QUOTE_DOUBLE,c=rr(r,a);break;default:return t(n,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[s,s+r.length,s+r.length]}}const u=s+r.length,f=ut(o,u,e,t);return{value:c,type:l,comment:f.comment,range:[s,u,f.offset]}}function sr(n,e){let t="";switch(n[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${n[0]}`;break}case"@":case"`":{t=`reserved character ${n[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),js(n)}function ir(n,e){return(n[n.length-1]!=="'"||n.length===1)&&e(n.length,"MISSING_CHAR","Missing closing 'quote"),js(n.slice(1,-1)).replace(/''/g,"'")}function js(n){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=e.exec(n);if(!s)return n;let i=s[1],r=" ",o=e.lastIndex;for(t.lastIndex=o;s=t.exec(n);)s[1]===""?r===`
`?i+=r:r=`
`:(i+=r+s[1],r=" "),o=t.lastIndex;const l=/[ \t]*(.*)/sy;return l.lastIndex=o,s=l.exec(n),i+r+((s==null?void 0:s[1])??"")}function rr(n,e){let t="";for(let s=1;s<n.length-1;++s){const i=n[s];if(!(i==="\r"&&n[s+1]===`
`))if(i===`
`){const{fold:r,offset:o}=or(n,s);t+=r,s=o}else if(i==="\\"){let r=n[++s];const o=lr[r];if(o)t+=o;else if(r===`
`)for(r=n[s+1];r===" "||r==="	";)r=n[++s+1];else if(r==="\r"&&n[s+1]===`
`)for(r=n[++s+1];r===" "||r==="	";)r=n[++s+1];else if(r==="x"||r==="u"||r==="U"){const l={x:2,u:4,U:8}[r];t+=ar(n,s+1,l,e),s+=l}else{const l=n.substr(s-1,2);e(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),t+=l}}else if(i===" "||i==="	"){const r=s;let o=n[s+1];for(;o===" "||o==="	";)o=n[++s+1];o!==`
`&&!(o==="\r"&&n[s+2]===`
`)&&(t+=s>r?n.slice(r,s+1):i)}else t+=i}return(n[n.length-1]!=='"'||n.length===1)&&e(n.length,"MISSING_CHAR",'Missing closing "quote'),t}function or(n,e){let t="",s=n[e+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&n[e+2]!==`
`);)s===`
`&&(t+=`
`),e+=1,s=n[e+1];return t||(t=" "),{fold:t,offset:e}}const lr={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"Â…",_:"Â ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function ar(n,e,t,s){const i=n.substr(e,t),o=i.length===t&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(o)){const l=n.substr(e-2,t+2);return s(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${l}`),l}return String.fromCodePoint(o)}function Fs(n,e,t,s){const{value:i,type:r,comment:o,range:l}=e.type==="block-scalar"?xi(n,e,s):nr(e,n.options.strict,s),c=t?n.directives.tagName(t.source,f=>s(t,"TAG_RESOLVE_FAILED",f)):null;let a;n.options.stringKeys&&n.atKey?a=n.schema[fe]:c?a=cr(n.schema,i,c,t,s):e.type==="scalar"?a=fr(n,i,e,s):a=n.schema[fe];let u;try{const f=a.resolve(i,d=>s(t??e,"TAG_RESOLVE_FAILED",d),n.options);u=D(f)?f:new $(f)}catch(f){const d=f instanceof Error?f.message:String(f);s(t??e,"TAG_RESOLVE_FAILED",d),u=new $(i)}return u.range=l,u.source=i,r&&(u.type=r),c&&(u.tag=c),a.format&&(u.format=a.format),o&&(u.comment=o),u}function cr(n,e,t,s,i){var l;if(t==="!")return n[fe];const r=[];for(const c of n.tags)if(!c.collection&&c.tag===t)if(c.default&&c.test)r.push(c);else return c;for(const c of r)if((l=c.test)!=null&&l.test(e))return c;const o=n.knownTags[t];return o&&!o.collection?(n.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(i(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),n[fe])}function fr({atKey:n,directives:e,schema:t},s,i,r){const o=t.tags.find(l=>{var c;return(l.default===!0||n&&l.default==="key")&&((c=l.test)==null?void 0:c.test(s))})||t[fe];if(t.compat){const l=t.compat.find(c=>{var a;return c.default&&((a=c.test)==null?void 0:a.test(s))})??t[fe];if(o.tag!==l.tag){const c=e.tagString(o.tag),a=e.tagString(l.tag),u=`Value may be parsed as either ${c} or ${a}`;r(i,"TAG_RESOLVE_FAILED",u,!0)}}return o}function ur(n,e,t){if(e){t??(t=e.length);for(let s=t-1;s>=0;--s){let i=e[s];switch(i.type){case"space":case"comment":case"newline":n-=i.source.length;continue}for(i=e[++s];(i==null?void 0:i.type)==="space";)n+=i.source.length,i=e[++s];break}}return n}const hr={composeNode:Ks,composeEmptyNode:_n};function Ks(n,e,t,s){const i=n.atKey,{spaceBefore:r,comment:o,anchor:l,tag:c}=t;let a,u=!0;switch(e.type){case"alias":a=dr(n,e,s),(l||c)&&s(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":a=Fs(n,e,c,s),l&&(a.anchor=l.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":a=Zi(hr,n,e,t,s),l&&(a.anchor=l.source.substring(1));break;default:{const f=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;s(e,"UNEXPECTED_TOKEN",f),a=_n(n,e.offset,void 0,null,t,s),u=!1}}return l&&a.anchor===""&&s(l,"BAD_ALIAS","Anchor cannot be an empty string"),i&&n.options.stringKeys&&(!D(a)||typeof a.value!="string"||a.tag&&a.tag!=="tag:yaml.org,2002:str")&&s(c??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(a.spaceBefore=!0),o&&(e.type==="scalar"&&e.source===""?a.comment=o:a.commentBefore=o),n.options.keepSourceTokens&&u&&(a.srcToken=e),a}function _n(n,e,t,s,{spaceBefore:i,comment:r,anchor:o,tag:l,end:c},a){const u={type:"scalar",offset:ur(e,t,s),indent:-1,source:""},f=Fs(n,u,l,a);return o&&(f.anchor=o.source.substring(1),f.anchor===""&&a(o,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(f.spaceBefore=!0),r&&(f.comment=r,f.range[2]=c),f}function dr({options:n},{offset:e,source:t,end:s},i){const r=new an(t.substring(1));r.source===""&&i(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&i(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=e+t.length,l=ut(s,o,n.strict,i);return r.range=[e,o,l.offset],l.comment&&(r.comment=l.comment),r}function pr(n,e,{offset:t,start:s,value:i,end:r},o){const l=Object.assign({_directives:e},n),c=new qt(void 0,l),a={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},u=Ye(s,{indicator:"doc-start",next:i??(r==null?void 0:r[0]),offset:t,onError:o,parentIndent:0,startOnNewline:!0});u.found&&(c.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!u.hasNewline&&o(u.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=i?Ks(a,i,u,o):_n(a,u.end,s,null,u,o);const f=c.contents.range[2],d=ut(r,f,!1,o);return d.comment&&(c.comment=d.comment),c.range=[t,f,d.offset],c}function Ze(n){if(typeof n=="number")return[n,n+1];if(Array.isArray(n))return n.length===2?n:[n[0],n[1]];const{offset:e,source:t}=n;return[e,e+(typeof t=="string"?t.length:1)]}function Pn(n){var i;let e="",t=!1,s=!1;for(let r=0;r<n.length;++r){const o=n[r];switch(o[0]){case"#":e+=(e===""?"":s?`

`:`
`)+(o.substring(1)||" "),t=!0,s=!1;break;case"%":((i=n[r+1])==null?void 0:i[0])!=="#"&&(r+=1),t=!1;break;default:t||(s=!0),t=!1}}return{comment:e,afterEmptyLine:s}}class mr{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,s,i,r)=>{const o=Ze(t);r?this.warnings.push(new Hi(o,s,i)):this.errors.push(new et(o,s,i))},this.directives=new x({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:s,afterEmptyLine:i}=Pn(this.prelude);if(s){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${s}`:s;else if(i||e.directives.docStart||!r)e.commentBefore=s;else if(R(r)&&!r.flow&&r.items.length>0){let o=r.items[0];V(o)&&(o=o.key);const l=o.commentBefore;o.commentBefore=l?`${s}
${l}`:s}else{const o=r.commentBefore;r.commentBefore=o?`${s}
${o}`:s}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Pn(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,s=-1){for(const i of e)yield*this.next(i);yield*this.end(t,s)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,s,i)=>{const r=Ze(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",s,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=pr(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,s=new et(Ze(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){const s="Unexpected doc-end without preceding document";this.errors.push(new et(Ze(e),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;const t=ut(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const s=this.doc.comment;this.doc.comment=s?`${s}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new et(Ze(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const s=Object.assign({_directives:this.directives},this.options),i=new qt(void 0,s);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}}const qs="\uFEFF",Rs="",Us="",sn="";function gr(n){switch(n){case qs:return"byte-order-mark";case Rs:return"doc-mode";case Us:return"flow-error-end";case sn:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(n[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function le(n){switch(n){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Bn=new Set("0123456789ABCDEFabcdef"),yr=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),mt=new Set(",[]{}"),br=new Set(` ,[]{}
\r	`),Jt=n=>!n||br.has(n);class wr{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let s=this.next??"stream";for(;s&&(t||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let s=0;for(;t===" ";)t=this.buffer[++s+e];if(t==="\r"){const i=this.buffer[s+e+1];if(i===`
`||!i&&!this.atEnd)return e+s+1}return t===`
`||s>=this.indentNext||!t&&!this.atEnd?e+s:-1}if(t==="-"||t==="."){const s=this.buffer.substr(e,3);if((s==="---"||s==="...")&&le(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===qs&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,s=e.indexOf("#");for(;s!==-1;){const r=e[s-1];if(r===" "||r==="	"){t=s-1;break}else s=e.indexOf("#",s+1)}for(;;){const r=e[t-1];if(r===" "||r==="	")t-=1;else break}const i=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Rs,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&le(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!le(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&le(t)){const s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Jt),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,s=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=s=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const i=this.getLine();if(i===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&i[0]!=="#"||s===0&&(i.startsWith("---")||i.startsWith("..."))&&le(i[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield Us,yield*this.parseLineStart();let r=0;for(;i[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),i[r]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Jt),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||le(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}const s=this.buffer.substring(0,t);let i=s.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){const r=this.continueScalar(i+1);if(r===-1)break;i=s.indexOf(`
`,r)}i!==-1&&(t=i-(s[i-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>le(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,s;e:for(let r=this.pos;s=this.buffer[r];++r)switch(s){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{const o=this.buffer[r+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let i=e+1;for(s=this.buffer[i];s===" ";)s=this.buffer[++i];if(s==="	"){for(;s==="	"||s===" "||s==="\r"||s===`
`;)s=this.buffer[++i];e=i-1}else if(!this.blockScalarKeep)do{let r=e-1,o=this.buffer[r];o==="\r"&&(o=this.buffer[--r]);const l=r;for(;o===" ";)o=this.buffer[--r];if(o===`
`&&r>=this.pos&&r+1+t>l)e=r;else break}while(!0);return yield sn,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,s=this.pos-1,i;for(;i=this.buffer[++s];)if(i===":"){const r=this.buffer[s+1];if(le(r)||e&&mt.has(r))break;t=s}else if(le(i)){let r=this.buffer[s+1];if(i==="\r"&&(r===`
`?(s+=1,i=`
`,r=this.buffer[s+1]):t=s),r==="#"||e&&mt.has(r))break;if(i===`
`){const o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(e&&mt.has(i))break;t=s}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield sn,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const s=this.buffer.slice(this.pos,e);return s?(yield s,this.pos+=s.length,s.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Jt))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(le(t)||e&&mt.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!le(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(yr.has(t))t=this.buffer[++e];else if(t==="%"&&Bn.has(this.buffer[e+1])&&Bn.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,s;do s=this.buffer[++t];while(s===" "||e&&s==="	");const i=t-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=t),i}*pushUntil(e){let t=this.pos,s=this.buffer[t];for(;!e(s);)s=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class _r{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,s=this.lineStarts.length;for(;t<s;){const r=t+s>>1;this.lineStarts[r]<e?t=r+1:s=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const i=this.lineStarts[t-1];return{line:t,col:e-i+1}}}}function ge(n,e){for(let t=0;t<n.length;++t)if(n[t].type===e)return!0;return!1}function jn(n){for(let e=0;e<n.length;++e)switch(n[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function Vs(n){switch(n==null?void 0:n.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function gt(n){switch(n.type){case"document":return n.start;case"block-map":{const e=n.items[n.items.length-1];return e.sep??e.start}case"block-seq":return n.items[n.items.length-1].start;default:return[]}}function Me(n){var t;if(n.length===0)return[];let e=n.length;e:for(;--e>=0;)switch(n[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=n[++e])==null?void 0:t.type)==="space";);return n.splice(e,n.length)}function Fn(n){if(n.start.type==="flow-seq-start")for(const e of n.items)e.sep&&!e.value&&!ge(e.start,"explicit-key-ind")&&!ge(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,Vs(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class vr{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new wr,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const s of this.lexer.lex(e,t))yield*this.next(s);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=gr(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const s=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(e==null?void 0:e.type)!=="doc-end"){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const s=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in s?s.indent:0:t.type==="flow-collection"&&s.type==="document"&&(t.indent=0),t.type==="flow-collection"&&Fn(t),s.type){case"document":s.value=t;break;case"block-scalar":s.props.push(t);break;case"block-map":{const i=s.items[s.items.length-1];if(i.value){s.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=t;else{Object.assign(i,{key:t,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{const i=s.items[s.items.length-1];i.value?s.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{const i=s.items[s.items.length-1];!i||i.value?s.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&jn(i.start)===-1&&(t.indent===0||i.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(s.type==="document"?s.end=i.start:s.items.push({start:i.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{jn(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=gt(this.peek(2)),s=Me(t);let i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:s,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var s;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const i="end"in t.value?t.value.end:void 0,r=Array.isArray(i)?i[i.length-1]:void 0;(r==null?void 0:r.type)==="comment"?i==null||i.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2],r=(s=i==null?void 0:i.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const i=!this.onKeyLine&&this.indent===e.indent,r=i&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let o=[];if(r&&t.sep&&!t.value){const l=[];for(let c=0;c<t.sep.length;++c){const a=t.sep[c];switch(a.type){case"newline":l.push(c);break;case"space":break;case"comment":a.indent>e.indent&&(l.length=0);break;default:l.length=0}}l.length>=2&&(o=t.sep.splice(l[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(o.push(this.sourceToken),e.items.push({start:o}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(o.push(this.sourceToken),e.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(ge(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(Vs(t.key)&&!ge(t.sep,"newline")){const l=Me(t.start),c=t.key,a=t.sep;a.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:l,key:c,sep:a}]})}else o.length>0?t.sep=t.sep.concat(o,this.sourceToken):t.sep.push(this.sourceToken);else if(ge(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const l=Me(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:l,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:o,key:null,sep:[this.sourceToken]}):ge(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const l=this.flowScalar(this.type);r||t.value?(e.items.push({start:o,key:l,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(l):(Object.assign(t,{key:l,sep:[]}),this.onKeyLine=!0);return}default:{const l=this.startBlockValue(e);if(l){if(l.type==="block-seq"){if(!t.explicitKey&&t.sep&&!ge(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else i&&e.items.push({start:o});this.stack.push(l);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var s;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const i="end"in t.value?t.value.end:void 0,r=Array.isArray(i)?i[i.length-1]:void 0;(r==null?void 0:r.type)==="comment"?i==null||i.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2],r=(s=i==null?void 0:i.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||ge(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const i=this.startBlockValue(e);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while((s==null?void 0:s.type)==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const s=this.startBlockValue(e);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{const s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===e.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){const i=gt(s),r=Me(i);Fn(e);const o=e.end.splice(1,e.end.length);o.push(this.sourceToken);const l={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=l}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=gt(e),s=Me(t);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=gt(e),s=Me(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function kr(n){const e=n.prettyErrors!==!1;return{lineCounter:n.lineCounter||e&&new _r||null,prettyErrors:e}}function Sr(n,e={}){const{lineCounter:t,prettyErrors:s}=kr(e),i=new vr(t==null?void 0:t.addNewLine),r=new mr(e);let o=null;for(const l of r.compose(i.parse(n),!0,n.length))if(!o)o=l;else if(o.options.logLevel!=="silent"){o.errors.push(new et(l.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&t&&(o.errors.forEach(Mn(n,t)),o.warnings.forEach(Mn(n,t))),o}function Nr(n,e,t){let s;const i=Sr(n,t);if(!i)return null;if(i.warnings.forEach(r=>gs(i.options.logLevel,r)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:s},t))}function De(n,e){try{const t=Nr(n);if(t==null)throw new Error("YAML file is empty or invalid");return{value:t,source:e}}catch(t){const s=t instanceof Error?t.message:"Unknown YAML parse error";throw new Error(`YAML parse error in ${e}: ${s}`)}}function Er(){const n=pi(),e={};for(const[s,i]of Object.entries(n.scenes))e[s]=De(i,`scenes/${s}`);const t={};for(const[s,i]of Object.entries(n.localization)){const r=s.replace(/\.ya?ml$/,"");t[r]=De(i,`localization/${s}`)}return{game:De(n.game,"game.yaml"),rules:De(n.rules,"rules.yaml"),state:De(n.state,"state.yaml"),items:De(n.items,"items.yaml"),scenes:e,localization:t}}class v extends Error{constructor(t,s,i){super(s);W(this,"code");W(this,"file");W(this,"path");this.code=t,this.file=i==null?void 0:i.file,this.path=i==null?void 0:i.path}toString(){let t=`[${this.code}] ${this.message}`;return this.file&&(t+=`
File: ${this.file}`),this.path&&(t+=`
Path: ${this.path}`),t}}function Ir(n){$r(n),Tr(n),Ar(n),Lr(n),Cr(n),Pr(n)}function Ot(n,e){const t=Object.keys(n);if(t.length!==1)throw new v("E_CONDITION_INVALID",`Condition must contain exactly one operator at ${e}`);const s=t[0];if(s==="all"||s==="any"){const r=n[s];if(!Array.isArray(r)||r.length===0)throw new v("E_CONDITION_INVALID",`"${s}" must be a non-empty array at ${e}`);r.forEach((o,l)=>Ot(o,`${e}.${s}[${l}]`));return}if(s==="not"){const r=n.not;if(!r)throw new v("E_CONDITION_INVALID",`"not" condition missing value at ${e}`);Ot(r,`${e}.not`);return}const i=n[s];if(typeof i!="object"||i===null||!i.var||!("value"in i))throw new v("E_CONDITION_INVALID",`Invalid payload for operator "${s}" at ${e}`)}function Or(n,e,t){n&&n.forEach((s,i)=>{const r=Object.keys(s);if(r.length!==1)throw new v("E_EFFECT_INVALID",`Effect must contain exactly one operator at ${e}[${i}]`);const o=r[0],l=s[o];if(o==="set"&&!l.var)throw new v("E_EFFECT_INVALID",`Set effect missing var at ${e}[${i}]`);if(o==="add"){if(!l.var)throw new v("E_EFFECT_INVALID",`Add effect missing var at ${e}[${i}]`);if(typeof l.value=="object"&&"random"in l.value&&!/^\d+\/\d+$/.test(l.value.random))throw new v("E_EFFECT_INVALID",`Invalid random format at ${e}[${i}]`)}if(o==="add_item"||o==="remove_item"){if(!l||typeof l.id!="string")throw new v("E_EFFECT_INVALID",`${o} requires { id: string } at ${e}[${i}]`);if(!t.items.items[l.id])throw new v("E_REF_NOT_FOUND",`Unknown item "${l.id}" at ${e}[${i}]`,{file:"items.yaml",path:`items.${l.id}`})}})}function $r(n){const e=n.manifest.game;if(!e.id||!e.title||!e.version)throw new v("E_SCHEMA_MISSING_FIELD","Missing required game metadata fields",{file:"game.yaml"})}function Tr(n){if(!n.rules.rules.systems)throw new v("E_SCHEMA_MISSING_FIELD","rules.systems is required",{file:"rules.yaml"})}function Ar(n){const e=n.state.state.variables,t=n.rules.rules.systems;for(const[s,i]of Object.entries(e)){if(i.requires&&!t[i.requires])throw new v("E_SYSTEM_DISABLED_USAGE",`State variable "${s}" requires disabled system "${i.requires}"`,{file:"state.yaml",path:`state.variables.${s}`});if(typeof i.initial!==i.type)throw new v("E_STATE_TYPE_MISMATCH",`Initial value of "${s}" does not match declared type "${i.type}"`,{file:"state.yaml",path:`state.variables.${s}.initial`})}}function Lr(n){const e=n.items.items;for(const[t,s]of Object.entries(e))if(!s.name)throw new v("E_SCHEMA_MISSING_FIELD",`Item "${t}" missing name`,{file:"items.yaml",path:`items.${t}.name`})}function Cr(n){const e=new Set;for(const[t,s]of Object.entries(n.scenes)){const i=s.scene;if(e.has(i.id))throw new v("E_DUPLICATE_ID",`Duplicate scene id "${i.id}"`,{file:`scenes/${t}`,path:"scene.id"});e.add(i.id),Mr(s,t,n)}}function Mr(n,e,t){const s=new Set;for(const i of n.scene.nodes){if(s.has(i.id))throw new v("E_DUPLICATE_ID",`Duplicate node id "${i.id}" in scene "${n.scene.id}"`,{file:`scenes/${e}`,path:"scene.nodes[].id"});s.add(i.id),i.text.forEach((r,o)=>{typeof r!="string"&&"if"in r&&Ot(r.if,`scene.${n.scene.id}.node.${i.id}.text[${o}].if`)}),Dr(i,n.scene.id,e,t)}}function Dr(n,e,t,s){for(const i of n.choices){if(!i.goto)throw new v("E_SCHEMA_MISSING_FIELD",`Choice "${i.id}" is missing goto`,{file:`scenes/${t}`,path:`node.${n.id}.choices.${i.id}`});i.if&&Ot(i.if,`scene.${e}.node.${n.id}.choice.${i.id}.if`),Or(i.effects,`scene.${e}.node.${n.id}.choice.${i.id}.effects`,s)}}function Pr(n){const{scene:e,node:t}=n.manifest.game.start,s=Object.values(n.scenes).find(r=>r.scene.id===e);if(!s)throw new v("E_REF_NOT_FOUND_SCENE",`Start scene "${e}" not found`,{file:"game.yaml",path:"game.start.scene"});if(!s.scene.nodes.find(r=>r.id===t))throw new v("E_REF_NOT_FOUND_NODE",`Start node "${t}" not found in scene "${e}"`,{file:"game.yaml",path:"game.start.node"})}function Br(n){return{manifest:n.manifest.game,rules:n.rules.rules,state:jr(n),items:Fr(n),scenes:Kr(n),localization:n.localization,language:"en"}}function jr(n){const e=n.rules.rules.state_visibility.default==="visible",t=new Map;for(const[s,i]of Object.entries(n.state.state.variables))t.set(s,{type:i.type,value:i.initial,visible:i.visible!==void 0?i.visible:e});return{variables:t}}function Fr(n){const e=new Map;for(const[t,s]of Object.entries(n.items.items))e.set(t,s);return e}function Kr(n){const e=new Map;for(const t of Object.values(n.scenes)){const s=t.scene.id;e.set(s,{id:s,nodes:qr(t)})}return e}function qr(n){const e=new Map;for(const t of n.scene.nodes)e.set(t.id,{id:t.id,text:t.text,choices:t.choices});return e}class Rr{constructor(e){W(this,"_at");W(this,"_state");W(this,"_history",[]);W(this,"_rng");W(this,"_inventory",new Set);const t=e.manifest.start;this._at={scene:t.scene,node:t.node},this._state=Ur(e.state)}get at(){return this._at}get history(){return this._history}get rng(){return this._rng}get inventory(){return this._inventory}getVar(e){const t=this._state.variables.get(e);if(!t)throw new v("E_STATE_VAR_UNDECLARED",`Unknown state var "${e}"`,{path:`state.variables.${e}`});return t.value}setVar(e,t){const s=this._state.variables.get(e);if(!s)throw new v("E_STATE_VAR_UNDECLARED",`Unknown state var "${e}"`,{path:`state.variables.${e}`});s.value=t}getVisibleState(){const e={};for(const[t,s]of this._state.variables.entries())s.visible&&(e[t]=s.value);return e}move(e,t,s){this._at=e,this._history.push({from:s,to:e,choiceId:t,ts:Date.now()})}save(){const e={};for(const[t,s]of this._state.variables.entries())e[t]=s.value;return{version:"0.1",at:{...this._at},state:e,history:[...this._history],rng:this._rng?{...this._rng}:void 0,inventory:[...this._inventory]}}load(e){if(e.version!=="0.1")throw new v("E_SCHEMA_INVALID_TYPE",`Unsupported save version "${e.version}"`);this._at={...e.at},this._history=[...e.history];for(const[t,s]of Object.entries(e.state)){const i=this._state.variables.get(t);if(!i)throw new v("E_STATE_VAR_UNDECLARED",`Save contains unknown var "${t}"`);i.value=s}e.rng&&(this._rng={...e.rng}),e.inventory&&(this._inventory=new Set(e.inventory))}initializeRng(e){this._rng||(this._rng={seed:e,counter:0})}addItem(e){this._inventory.add(e)}removeItem(e){this._inventory.delete(e)}hasItem(e){return this._inventory.has(e)}}function Ur(n){const e=new Map(n.variables);for(const[t,s]of e.entries())e.set(t,{...s});return{variables:e}}function Ie(n,e,t,s){return Gr(n)?Yr(n,e,t,s):Vr(n,e,t,s)}function Vr(n,e,t,s){const i=Object.keys(n);if(i.length!==1)throw new v("E_CONDITION_INVALID","Operator condition must contain exactly one operator");const r=i[0],o=n[r],l=s.findConditionHandler(r);if(!l)throw new v("E_CONDITION_INVALID",`Unknown condition operator "${r}"`);return l(o,e,t)}function Yr(n,e,t,s){if(n.all)return n.all.every(i=>Ie(i,e,t,s));if(n.any)return n.any.some(i=>Ie(i,e,t,s));if(n.not)return!Ie(n.not,e,t,s);throw new v("E_CONDITION_INVALID","Empty logical condition")}function Gr(n){return"all"in n||"any"in n||"not"in n}function zr(n,e,t,s){if(!(!n||n.length===0))for(const i of n){const r=Object.keys(i)[0],o=s.findEffectHandler(r);if(!o)throw new v("E_EFFECT_INVALID",`Unknown effect operator "${r}"`);o(i[r],e,t)}}function Ht(n,e,t,s){const i=[];for(const r of n){if(typeof r=="string"){i.push(yt(r,e,t,s));continue}if(Hr(r)){const o=Kn(r.key,t);i.push(yt(o,e,t,s));continue}if("if"in r){if(Ie(r.if,e,t,s)){const o=r.then;if(typeof o=="string")i.push(yt(o,e,t,s));else{const l=Kn(o.key,t);i.push(yt(l,e,t,s))}}continue}throw new v("E_SCHEMA_INVALID_TYPE","Unknown text fragment structure")}return i}function Kn(n,e){const t=e.language,s=e.localization[t];if(!s)throw new v("E_LOCALIZATION_KEY_MISSING",`Language "${t}" not loaded`);const i=n.split(".");let r=s;for(const o of i)if(r=r==null?void 0:r[o],r===void 0)throw new v("E_LOCALIZATION_KEY_MISSING",`Localization key "${n}" not found for language "${t}"`);if(typeof r!="string")throw new v("E_LOCALIZATION_KEY_MISSING",`Localization key "${n}" does not resolve to string`);return r}function yt(n,e,t,s){const i=/\{\{if (.*?)\}\}([\s\S]*?)\{\{\/if\}\}/g;return n=n.replace(i,(r,o,l)=>{const c=Jr(o);return Ie(c,e,t,s)?l:""}),n.replace(/\{\{(.*?)\}\}/g,(r,o)=>{const l=o.trim();if(l==="inventory_count")return String(e.inventory.size);if(l==="inventory_list")return e.inventory.size===0?"(none)":Array.from(e.inventory).map(a=>{const u=t.items.get(a);if(!u)throw new v("E_REF_NOT_FOUND",`Inventory contains unknown item "${a}"`);return u.name}).join(", ");if(l.startsWith("has_item:")){const c=l.slice(9).trim();if(!t.items.has(c))throw new v("E_REF_NOT_FOUND",`Interpolation references unknown item "${c}"`);return String(e.hasItem(c))}try{const c=e.getVar(l);return String(c)}catch{throw new v("E_STATE_VAR_UNDECLARED",`Interpolation variable "${l}" not declared`)}})}function Jr(n){const e=n.trim().split(/\s+/);if(e.length===0)throw new v("E_CONDITION_INVALID","Empty inline condition");const t=e[0];if(t==="has_item"){if(e.length!==2)throw new v("E_CONDITION_INVALID","has_item requires one argument");return{has_item:{id:e[1]}}}if(e.length!==3)throw new v("E_CONDITION_INVALID",`Invalid inline condition format "${n}"`);const[s,i,r]=e;let o=r;return r==="true"?o=!0:r==="false"?o=!1:isNaN(Number(r))||(o=Number(r)),{[t]:{var:i,value:o}}}function Hr(n){return typeof n=="object"&&n!==null&&"key"in n}class Wr{constructor(){W(this,"plugins",[]);W(this,"finalized",!1)}register(e){if(this.finalized)throw new v("E_PLUGIN_REGISTRY_LOCKED","Cannot register plugins after registry is finalized");this.plugins.push(e)}finalize(){const e=new Set;for(const t of this.plugins){if(e.has(t.id))throw new v("E_PLUGIN_DUPLICATE_ID",`Duplicate plugin id "${t.id}"`);e.add(t.id)}for(const t of this.plugins)for(const s of t.dependsOn??[])if(!e.has(s))throw new v("E_PLUGIN_DEPENDENCY_MISSING",`Plugin "${t.id}" depends on missing plugin "${s}"`);this.plugins=Qr(this.plugins),this.finalized=!0}getAll(){return this.plugins}runHook(e,t,s){var i;for(const r of this.plugins){const o=(i=r.hooks)==null?void 0:i[e];o&&o(t,s)}}findConditionHandler(e){var t;for(const s of this.plugins){const i=(t=s.conditions)==null?void 0:t[e];if(i)return i}}findEffectHandler(e){var t;for(const s of this.plugins){const i=(t=s.effects)==null?void 0:t[e];if(i)return i}}}function Qr(n){var l,c;const e=new Map;for(const a of n)e.set(a.id,a);const t=new Map,s=new Map;for(const a of n)t.set(a.id,new Set),s.set(a.id,0);function i(a,u){t.get(a).has(u)||(t.get(a).add(u),s.set(u,(s.get(u)??0)+1))}for(const a of n)for(const u of a.dependsOn??[])i(u,a.id);for(const a of n){for(const u of((l=a.order)==null?void 0:l.after)??[]){if(!e.has(u))throw new v("E_PLUGIN_ORDER_UNKNOWN",`Plugin "${a.id}" orders after unknown plugin "${u}"`);i(u,a.id)}for(const u of((c=a.order)==null?void 0:c.before)??[]){if(!e.has(u))throw new v("E_PLUGIN_ORDER_UNKNOWN",`Plugin "${a.id}" orders before unknown plugin "${u}"`);i(a.id,u)}}const r=[];for(const a of n)(s.get(a.id)??0)===0&&r.push(a.id);const o=[];for(;r.length>0;){const a=r.shift();o.push(e.get(a));for(const u of t.get(a))s.set(u,(s.get(u)??0)-1),(s.get(u)??0)===0&&r.push(u)}if(o.length!==n.length)throw new v("E_PLUGIN_ORDER_CYCLE","Plugin ordering contains a cycle");return o}const Xr={id:"core",conditions:{eq(n,e){const{var:t,value:s}=n;return e.getVar(t)===s},neq(n,e){const{var:t,value:s}=n;return e.getVar(t)!==s},gt(n,e){return bt(n,e,(t,s)=>t>s)},gte(n,e){return bt(n,e,(t,s)=>t>=s)},lt(n,e){return bt(n,e,(t,s)=>t<s)},lte(n,e){return bt(n,e,(t,s)=>t<=s)}},effects:{set(n,e){const{var:t,value:s}=n,i=e.getVar(t);if(typeof i!=typeof s)throw new v("E_STATE_TYPE_MISMATCH",`Cannot set "${t}" (${typeof i}) to ${typeof s}`);e.setVar(t,s)},add(n,e,t){const{var:s,value:i}=n,r=e.getVar(s);if(typeof r!="number")throw new v("E_STATE_TYPE_MISMATCH",`Cannot add to non-number variable "${s}"`);if(typeof i!="number")throw new v("E_EFFECT_INVALID","Random values require randomness system enabled");const o=i;e.setVar(s,r+o)}}};function bt(n,e,t){const{var:s,value:i}=n,r=e.getVar(s);if(typeof r!="number"||typeof i!="number")throw new v("E_CONDITION_INVALID","Numeric comparison requires numbers");return t(r,i)}const Zr={id:"randomness",order:{after:["core"]},dependsOn:["core"],hooks:{onStart(n){n.initializeRng(Date.now())}},effects:{add(n,e,t){if(typeof n.value!="object"||!n.value||!("random"in n.value))return;const{var:s}=n,i=e.getVar(s);if(typeof i!="number")throw new v("E_STATE_TYPE_MISMATCH",`Cannot add random value to non-number variable "${s}"`);const r=xr(n.value.random,e);e.setVar(s,i+r)}}};function xr(n,e){const t=e.rng;if(!t)throw new v("E_EFFECT_INVALID","Randomness system enabled but RNG state missing");const s=n.split("/");if(s.length!==2)throw new v("E_EFFECT_INVALID",`Invalid random format "${n}"`);const i=Number(s[0]),r=Number(s[1]);if(!Number.isFinite(i)||!Number.isFinite(r)||r<=0)throw new v("E_EFFECT_INVALID",`Invalid random values "${n}"`);const o=t.seed,l=t.counter++;return Math.abs(Math.sin(o+l)*1e4)%1<i/r?1:0}const eo={id:"inventory",dependsOn:["core"],order:{after:["core"]},conditions:{has_item(n,e,t){if(!n||typeof n.id!="string")throw new v("E_CONDITION_INVALID","has_item requires { id: string }");if(!t.items.has(n.id))throw new v("E_REF_NOT_FOUND",`Unknown item "${n.id}"`);return e.hasItem(n.id)}},effects:{add_item(n,e,t){if(!n||typeof n.id!="string")throw new v("E_EFFECT_INVALID","add_item requires { id: string }");if(!t.items.has(n.id))throw new v("E_REF_NOT_FOUND",`Unknown item "${n.id}"`);e.addItem(n.id)},remove_item(n,e,t){if(!n||typeof n.id!="string")throw new v("E_EFFECT_INVALID","remove_item requires { id: string }");if(!t.items.has(n.id))throw new v("E_REF_NOT_FOUND",`Unknown item "${n.id}"`);e.removeItem(n.id)}}};class to{constructor(e){W(this,"model");W(this,"session");W(this,"plugins",new Wr);this.model=e,this.session=new Rr(e),this.assertNodeExists(this.session.at),this.plugins.register(Xr),this.model.rules.systems.randomness&&this.plugins.register(Zr),this.model.rules.systems.inventory&&this.plugins.register(eo),this.plugins.finalize()}start(){return this.plugins.runHook("onStart",this.session,this.model),this.assertNodeExists(this.session.at),this.getViewModel()}getViewModel(){const e=this.session.at,t=this.getNode(e);return{gameTitle:this.model.manifest.title,sceneId:e.scene,nodeId:e.node,text:Ht(t.text,this.session,this.model,this.plugins),choices:t.choices.filter(s=>!s.if||Ie(s.if,this.session,this.model,this.plugins)).map(s=>({id:s.id,text:this.resolveChoiceText(s.text),enabled:!0})),visibleState:this.session.getVisibleState(),inventory:Array.from(this.session.inventory).map(s=>{const i=this.model.items.get(s);if(!i)throw new v("E_REF_NOT_FOUND",`Inventory contains unknown item "${s}"`);const r=o=>{if(o)return Ht([{key:o}],this.session,this.model,this.plugins)[0]};return{id:s,name:r(i.name)??i.name,description:r(i.description)??i.description}})}}resolveChoiceText(e){if(e.includes("."))try{return Ht([{key:e}],this.session,this.model,this.plugins)[0]}catch{return e}return e}choose(e){const t=this.session.at,i=this.getNode(t).choices.find(o=>o.id===e);if(!i)throw new v("E_RUNTIME_ILLEGAL_CHOICE",`Choice "${e}" not found in node "${t.scene}.${t.node}"`);if(this.plugins.runHook("beforeChoice",this.session,this.model),i.if&&!Ie(i.if,this.session,this.model,this.plugins))throw new v("E_RUNTIME_ILLEGAL_CHOICE",`Choice "${e}" is not currently available`);const r={scene:i.goto.scene,node:i.goto.node};return this.assertNodeExists(r),this.plugins.runHook("beforeTransition",this.session,this.model),zr(i.effects,this.session,this.model,this.plugins),this.session.move(r,e,t),this.plugins.runHook("afterTransition",this.session,this.model),this.plugins.runHook("afterChoice",this.session,this.model),this.getViewModel()}save(){return this.session.save()}load(e){return this.session.load(e),this.assertNodeExists(this.session.at),this.getViewModel()}getNode(e){const t=this.model.scenes.get(e.scene);if(!t)throw new v("E_REF_NOT_FOUND_SCENE",`Scene "${e.scene}" not found`);const s=t.nodes.get(e.node);if(!s)throw new v("E_REF_NOT_FOUND_NODE",`Node "${e.node}" not found in scene "${e.scene}"`);return s}assertNodeExists(e){this.getNode(e)}getCurrentNodeRef(){return this.session.at}getFullState(){return this.session.save().state}getHistory(){return this.session.history}getAllScenes(){return this.model.scenes}getInventory(){return Array.from(this.session.inventory).map(e=>{const t=this.model.items.get(e);return{id:e,name:t.name,description:t.description}})}}const Pe=[];function no(n,e=Q){let t;const s=new Set;function i(l){if(lt(n,l)&&(n=l,t)){const c=!Pe.length;for(const a of s)a[1](),Pe.push(a,n);if(c){for(let a=0;a<Pe.length;a+=2)Pe[a][0](Pe[a+1]);Pe.length=0}}}function r(l){i(l(n))}function o(l,c=Q){const a=[l,c];return s.add(a),s.size===1&&(t=e(i,r)||Q),l(n),()=>{s.delete(a),s.size===0&&t&&(t(),t=null)}}return{set:i,update:r,subscribe:o}}const Ne=no({engine:null,viewModel:null});function qn(n,e,t){const s=n.slice();return s[4]=e[t][0],s[5]=e[t][1],s}function Rn(n,e,t){const s=n.slice();return s[8]=e[t],s}function Un(n){var vn,kn;let e,t,s,i,r,o,l,c=((vn=n[1].viewModel)==null?void 0:vn.sceneId)+"",a,u,f=((kn=n[1].viewModel)==null?void 0:kn.nodeId)+"",d,p,g,h,m,y,k,N=JSON.stringify(n[1].engine.getFullState(),null,2)+"",S,E,T,b,_,O,C,Y=JSON.stringify(n[1].engine.getInventory(),null,2)+"",G,F,X,Te,ue,K,Qe,he=JSON.stringify(n[1].engine.getHistory(),null,2)+"",te,I,L,B,H,Xe,Ae=ce(Array.from(n[1].engine.getAllScenes().entries())),Z=[];for(let q=0;q<Ae.length;q+=1)Z[q]=Yn(qn(n,Ae,q));return{c(){e=A("div"),t=A("h3"),t.textContent="DEBUG PANEL",s=j(),i=A("section"),r=A("strong"),r.textContent="Current Node:",o=j(),l=A("div"),a=P(c),u=P(`.
        `),d=P(f),p=j(),g=A("section"),h=A("strong"),h.textContent="State:",m=j(),y=A("pre"),k=P(""),S=P(N),E=P(`
      `),T=j(),b=A("section"),_=A("strong"),_.textContent="Inventory:",O=j(),C=A("pre"),G=P(Y),F=j(),X=A("section"),Te=A("strong"),Te.textContent="History:",ue=j(),K=A("pre"),Qe=P(""),te=P(he),I=P(`
      `),L=j(),B=A("section"),H=A("strong"),H.textContent="Jump To:",Xe=j();for(let q=0;q<Z.length;q+=1)Z[q].c();M(i,"class","svelte-1lq35cb"),M(g,"class","svelte-1lq35cb"),M(b,"class","svelte-1lq35cb"),M(X,"class","svelte-1lq35cb"),M(B,"class","svelte-1lq35cb"),M(e,"class","debug svelte-1lq35cb")},m(q,de){J(q,e,de),w(e,t),w(e,s),w(e,i),w(i,r),w(i,o),w(i,l),w(l,a),w(l,u),w(l,d),w(e,p),w(e,g),w(g,h),w(g,m),w(g,y),w(y,k),w(y,S),w(y,E),w(e,T),w(e,b),w(b,_),w(b,O),w(b,C),w(C,G),w(e,F),w(e,X),w(X,Te),w(X,ue),w(X,K),w(K,Qe),w(K,te),w(K,I),w(e,L),w(e,B),w(B,H),w(B,Xe);for(let we=0;we<Z.length;we+=1)Z[we]&&Z[we].m(B,null)},p(q,de){var we,Sn;if(de&2&&c!==(c=((we=q[1].viewModel)==null?void 0:we.sceneId)+"")&&ne(a,c),de&2&&f!==(f=((Sn=q[1].viewModel)==null?void 0:Sn.nodeId)+"")&&ne(d,f),de&2&&N!==(N=JSON.stringify(q[1].engine.getFullState(),null,2)+"")&&ne(S,N),de&2&&Y!==(Y=JSON.stringify(q[1].engine.getInventory(),null,2)+"")&&ne(G,Y),de&2&&he!==(he=JSON.stringify(q[1].engine.getHistory(),null,2)+"")&&ne(te,he),de&6){Ae=ce(Array.from(q[1].engine.getAllScenes().entries()));let se;for(se=0;se<Ae.length;se+=1){const Nn=qn(q,Ae,se);Z[se]?Z[se].p(Nn,de):(Z[se]=Yn(Nn),Z[se].c(),Z[se].m(B,null))}for(;se<Z.length;se+=1)Z[se].d(1);Z.length=Ae.length}},d(q){q&&z(e),$t(Z,q)}}}function Vn(n){let e,t=n[8]+"",s,i,r;function o(){return n[3](n[4],n[8])}return{c(){e=A("button"),s=P(t),M(e,"class","svelte-1lq35cb")},m(l,c){J(l,e,c),w(e,s),i||(r=rn(e,"click",o),i=!0)},p(l,c){n=l,c&2&&t!==(t=n[8]+"")&&ne(s,t)},d(l){l&&z(e),i=!1,r()}}}function Yn(n){let e,t,s=n[4]+"",i,r,o,l=ce(Array.from(n[5].nodes.keys())),c=[];for(let a=0;a<l.length;a+=1)c[a]=Vn(Rn(n,l,a));return{c(){e=A("div"),t=A("strong"),i=P(s),r=j();for(let a=0;a<c.length;a+=1)c[a].c();o=j()},m(a,u){J(a,e,u),w(e,t),w(t,i),w(e,r);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(e,null);w(e,o)},p(a,u){if(u&2&&s!==(s=a[4]+"")&&ne(i,s),u&6){l=ce(Array.from(a[5].nodes.keys()));let f;for(f=0;f<l.length;f+=1){const d=Rn(a,l,f);c[f]?c[f].p(d,u):(c[f]=Vn(d),c[f].c(),c[f].m(e,o))}for(;f<c.length;f+=1)c[f].d(1);c.length=l.length}},d(a){a&&z(e),$t(c,a)}}}function so(n){let e,t=n[0]&&n[1].engine&&Un(n);return{c(){t&&t.c(),e=ss()},m(s,i){t&&t.m(s,i),J(s,e,i)},p(s,[i]){s[0]&&s[1].engine?t?t.p(s,i):(t=Un(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(s){s&&z(e),t&&t.d(s)}}}function io(n,e,t){let s;ns(n,Ne,l=>t(1,s=l));let{visible:i=!1}=e;function r(l,c){const a=ts(Ne);if(!a.engine)return;const u=a.engine.save();u.at={scene:l,node:c};const f=a.engine.load(u);Ne.set({engine:a.engine,viewModel:f})}const o=(l,c)=>r(l,c);return n.$$set=l=>{"visible"in l&&t(0,i=l.visible)},[i,s,r,o]}class ro extends At{constructor(e){super(),Tt(this,e,io,so,lt,{visible:0})}}function oo(n){let e,t;return{c(){e=A("span"),t=P(n[0])},m(s,i){J(s,e,i),w(e,t)},p(s,[i]){i&1&&ne(t,s[0])},i:Q,o:Q,d(s){s&&z(e)}}}function lo(n,e,t){let{text:s}=e,{speed:i=20}=e,{onComplete:r}=e,o="",l=0,c;Ws(()=>{a()});function a(){c=setInterval(()=>{l<s.length?(t(0,o+=s[l]),l++):(clearInterval(c),r==null||r())},i)}return n.$$set=u=>{"text"in u&&t(1,s=u.text),"speed"in u&&t(2,i=u.speed),"onComplete"in u&&t(3,r=u.onComplete)},[o,s,i,r]}class ao extends At{constructor(e){super(),Tt(this,e,lo,oo,lt,{text:1,speed:2,onComplete:3})}}function Gn(n){let e;return{c(){e=P("_")},m(t,s){J(t,e,s)},d(t){t&&z(e)}}}function co(n){let e,t=n[0]&&Gn();return{c(){e=A("span"),t&&t.c(),M(e,"class","cursor svelte-l3cu36")},m(s,i){J(s,e,i),t&&t.m(e,null)},p(s,[i]){s[0]?t||(t=Gn(),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:Q,o:Q,d(s){s&&z(e),t&&t.d()}}}function fo(n,e,t){let s=!0;return setInterval(()=>{t(0,s=!s)},500),[s]}class uo extends At{constructor(e){super(),Tt(this,e,fo,co,lt,{})}}function zn(n,e,t){const s=n.slice();return s[6]=e[t],s}function Jn(n,e,t){const s=n.slice();return s[9]=e[t],s}function Hn(n,e,t){const s=n.slice();return s[12]=e[t],s[14]=t,s}function ho(n){let e,t,s,i=n[2].viewModel.gameTitle+"",r,o,l,c,a=[],u=new Map,f,d,p,g,h,m,y,k,N,S,E,T,b,_,O,C,Y,G,F=mo(n),X=ce(n[2].viewModel.text);const Te=I=>I[14]+"-"+I[12];for(let I=0;I<X.length;I+=1){let L=Hn(n,X,I),B=Te(L);u.set(B,a[I]=Wn(B,L))}d=new uo({});let ue=ce(n[2].viewModel.choices),K=[];for(let I=0;I<ue.length;I+=1)K[I]=Qn(Jn(n,ue,I));function Qe(I,L){return I[2].viewModel.inventory.length===0?yo:go}let he=Qe(n),te=he(n);return O=new ro({props:{visible:n[1]}}),{c(){e=A("div"),t=A("div"),s=A("h1"),r=P(i),o=j(),F&&F.c(),l=j(),c=A("div");for(let I=0;I<a.length;I+=1)a[I].c();f=j(),Xt(d.$$.fragment),p=j(),g=A("div");for(let I=0;I<K.length;I+=1)K[I].c();h=j(),m=A("div"),y=A("h3"),y.textContent="Inventory",k=j(),te.c(),N=j(),S=A("div"),E=A("h3"),E.textContent="Controls",T=j(),b=A("button"),b.textContent="[ Toggle Debug ]",_=j(),Xt(O.$$.fragment),M(s,"class","svelte-14dlzym"),M(t,"class","header svelte-14dlzym"),M(c,"class","content svelte-14dlzym"),M(g,"class","choices svelte-14dlzym"),M(y,"class","svelte-14dlzym"),M(m,"class","inventory svelte-14dlzym"),M(b,"class","svelte-14dlzym"),M(S,"class","controls svelte-14dlzym"),M(e,"class","terminal svelte-14dlzym")},m(I,L){J(I,e,L),w(e,t),w(t,s),w(s,r),w(t,o),F&&F.m(t,null),w(e,l),w(e,c);for(let B=0;B<a.length;B+=1)a[B]&&a[B].m(c,null);w(c,f),St(d,c,null),w(e,p),w(e,g);for(let B=0;B<K.length;B+=1)K[B]&&K[B].m(g,null);w(e,h),w(e,m),w(m,y),w(m,k),te.m(m,null),w(e,N),w(e,S),w(S,E),w(S,T),w(S,b),J(I,_,L),St(O,I,L),C=!0,Y||(G=rn(b,"click",n[5]),Y=!0)},p(I,L){if((!C||L&4)&&i!==(i=I[2].viewModel.gameTitle+"")&&ne(r,i),F.p(I,L),L&4&&(X=ce(I[2].viewModel.text),rs(),a=ti(a,L,Te,1,I,X,u,c,ei,Wn,f,Hn),os()),L&12){ue=ce(I[2].viewModel.choices);let H;for(H=0;H<ue.length;H+=1){const Xe=Jn(I,ue,H);K[H]?K[H].p(Xe,L):(K[H]=Qn(Xe),K[H].c(),K[H].m(g,null))}for(;H<K.length;H+=1)K[H].d(1);K.length=ue.length}he===(he=Qe(I))&&te?te.p(I,L):(te.d(1),te=he(I),te&&(te.c(),te.m(m,null)));const B={};L&2&&(B.visible=I[1]),O.$set(B)},i(I){if(!C){for(let L=0;L<X.length;L+=1)ye(a[L]);ye(d.$$.fragment,I),ye(O.$$.fragment,I),C=!0}},o(I){for(let L=0;L<a.length;L+=1)Ee(a[L]);Ee(d.$$.fragment,I),Ee(O.$$.fragment,I),C=!1},d(I){I&&(z(e),z(_)),F&&F.d();for(let L=0;L<a.length;L+=1)a[L].d();Nt(d),$t(K,I),te.d(),Nt(O,I),Y=!1,G()}}}function po(n){let e,t,s;return{c(){e=A("div"),t=A("pre"),s=P(n[0]),M(t,"class","error svelte-14dlzym"),M(e,"class","terminal svelte-14dlzym")},m(i,r){J(i,e,r),w(e,t),w(t,s)},p(i,r){r&1&&ne(s,i[0])},i:Q,o:Q,d(i){i&&z(e)}}}function mo(n){let e,t,s=n[2].viewModel.sceneId+"",i,r,o=n[2].viewModel.nodeId+"",l;return{c(){e=A("div"),t=A("i"),i=P(s),r=P("."),l=P(o),M(e,"class","node svelte-14dlzym")},m(c,a){J(c,e,a),w(e,t),w(t,i),w(t,r),w(t,l)},p(c,a){a&4&&s!==(s=c[2].viewModel.sceneId+"")&&ne(i,s),a&4&&o!==(o=c[2].viewModel.nodeId+"")&&ne(l,o)},d(c){c&&z(e)}}}function Wn(n,e){let t,s,i;return s=new ao({props:{text:e[12],speed:10,onComplete:wo}}),{key:n,first:null,c(){t=A("p"),Xt(s.$$.fragment),M(t,"class","svelte-14dlzym"),this.first=t},m(r,o){J(r,t,o),St(s,t,null),i=!0},p(r,o){e=r;const l={};o&4&&(l.text=e[12]),s.$set(l)},i(r){i||(ye(s.$$.fragment,r),i=!0)},o(r){Ee(s.$$.fragment,r),i=!1},d(r){r&&z(t),Nt(s)}}}function Qn(n){let e,t,s=n[9].text+"",i,r,o,l,c;function a(){return n[4](n[9])}return{c(){e=A("button"),t=P("> "),i=P(s),r=j(),e.disabled=o=!n[9].enabled,M(e,"class","svelte-14dlzym")},m(u,f){J(u,e,f),w(e,t),w(e,i),w(e,r),l||(c=rn(e,"click",a),l=!0)},p(u,f){n=u,f&4&&s!==(s=n[9].text+"")&&ne(i,s),f&4&&o!==(o=!n[9].enabled)&&(e.disabled=o)},d(u){u&&z(e),l=!1,c()}}}function go(n){let e,t=ce(n[2].viewModel.inventory),s=[];for(let i=0;i<t.length;i+=1)s[i]=Xn(zn(n,t,i));return{c(){e=A("ul");for(let i=0;i<s.length;i+=1)s[i].c();M(e,"class","svelte-14dlzym")},m(i,r){J(i,e,r);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null)},p(i,r){if(r&4){t=ce(i[2].viewModel.inventory);let o;for(o=0;o<t.length;o+=1){const l=zn(i,t,o);s[o]?s[o].p(l,r):(s[o]=Xn(l),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=t.length}},d(i){i&&z(e),$t(s,i)}}}function yo(n){let e;return{c(){e=A("p"),e.textContent="(empty)",M(e,"class","muted svelte-14dlzym")},m(t,s){J(t,e,s)},p:Q,d(t){t&&z(e)}}}function Xn(n){let e,t,s=n[6].name+"",i,r,o;return{c(){e=A("li"),t=P("â€¢ "),i=P(s),r=j(),M(e,"title",o=n[6].description),M(e,"class","svelte-14dlzym")},m(l,c){J(l,e,c),w(e,t),w(e,i),w(e,r)},p(l,c){c&4&&s!==(s=l[6].name+"")&&ne(i,s),c&4&&o!==(o=l[6].description)&&M(e,"title",o)},d(l){l&&z(e)}}}function bo(n){let e,t,s,i;const r=[po,ho],o=[];function l(c,a){return c[0]?0:c[2].viewModel?1:-1}return~(e=l(n))&&(t=o[e]=r[e](n)),{c(){t&&t.c(),s=ss()},m(c,a){~e&&o[e].m(c,a),J(c,s,a),i=!0},p(c,[a]){let u=e;e=l(c),e===u?~e&&o[e].p(c,a):(t&&(rs(),Ee(o[u],1,1,()=>{o[u]=null}),os()),~e?(t=o[e],t?t.p(c,a):(t=o[e]=r[e](c),t.c()),ye(t,1),t.m(s.parentNode,s)):t=null)},i(c){i||(ye(t),i=!0)},o(c){Ee(t),i=!1},d(c){c&&z(s),~e&&o[e].d(c)}}}const wo=()=>{};function _o(n,e,t){let s;ns(n,Ne,a=>t(2,s=a));let i=null,r=!1;try{const a=Er(),u={manifest:a.game.value,rules:a.rules.value,state:a.state.value,items:a.items.value,scenes:Object.fromEntries(Object.entries(a.scenes).map(([g,h])=>[g,h.value])),localization:Object.fromEntries(Object.entries(a.localization).map(([g,h])=>[g,h.value]))};Ir(u);const f=Br(u),d=new to(f),p=d.start();Ne.set({engine:d,viewModel:p})}catch(a){i=a instanceof Error?a.toString():String(a)}function o(a){const u=ts(Ne);if(!u.engine)return;const f=u.engine.choose(a);Ne.set({engine:u.engine,viewModel:f})}return[i,r,s,o,a=>o(a.id),()=>t(1,r=!r)]}class vo extends At{constructor(e){super(),Tt(this,e,_o,bo,lt,{})}}new vo({target:document.getElementById("app")});
